{% extends 'base/base.html' %}
{% load bootstrap4 %}
{% block main %}

<body onload="loadTest()">
    <br>
    <br>
    <br>
    <br>
    <br>
        
{% load bootstrap4 %}
<div class="col-lg-8 posts-list" >
	<form id="addVoucher">
		<h2>Seleccionar comprobante</h2>
		<br>
		<div id="separator">
			
		</div>
		<br>
		<h2>Seleccione el origen</h2>
		<br>	
			<div id="separatorOP">
				
			</div>
			<br>		
	</form>
	<div id="separatorButton" style="display:none">
		<button  onclick="generateDisponibilty()" id="generator" class="genric-btn primary small">GENERAR DISPONIBILIDAD DE PRESUPUESTO DE</button>
	</div>
</div>
<br>

<div id=divCreate class="container-fluid" style="display:none" >
	<div class="card mb-4">
		<div class="card-header"><i class="fas fa-table mr-1"></i>Agregar disponibilidad</div>
		<div class="card-body">
			<form id="createDisponibility">
				<div class="form-row">
					<div class="col-6">
						<label>Número de disponibilidad</label>
						<input type="number" name="disponibilityIn" id="disponibilityIn" class="form-control" placeholder="Número de disponibilidad" required>
					</div>
					<div class="col-6">
						<label>Fecha disponibilidad</label>				  
						<input name="date" id="date" type="date" class="form-control" >
					</div>
				</div>
				<br>
				<div class="form-row mb-3">
					<div class="col-6">
						<label for="exampleFormControlTextarea1">Observación</label>
						<textarea placeholder="Observación" name="observation" class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
					</div>					
				</div>
				<div  class="container-fluid mb-3" style="float:left">
					<div class="card" >
					<div class="card-header " id="textTable"><i class="fas fa-table mr-1" ></i>Lista de rubros por presupuesto de</div>
					<div class="card-body" >
						<div class="table-responsive">
							<div class="mb-2">
								<button  onclick="getRubrosByOrigin()" data-toggle="modal" data-target="#myModalRubroOrigin" class="genric-btn primary small">Agregar Rubros</button>               
							</div>
								<table class="table table-bordered dataTable" id="dataTableTest" cellspacing="0" 
								role="grid" aria-describedby="dataTable_info">	
								<thead>
									<tr>
										<th>ID</th>
										<th>Rubro</th>
										<th>Descripción</th>
										<th>Disponibilidad</th>
										<th>Valor Registro</th>
										<th>Saldo</th>
										<th>Acciones</th>
									</tr>
								</thead>
								<tfoot>
									<tr>
										<th>ID</th>
										<th>Rubro</th>
										<th>Descripción</th>
										<th>Disponibilidad</th>
										<th>Valor Registro</th>
										<th>Saldo</th>
										<th>Acciones</th>
									</tr>
								</tfoot>
									<tbody>
										<h1></h1>
									</tbody>
								</table>
								
						</div>
						<div class="form-row col-12 mb-2">
								
							<div class="col-8" >
								<h6  id="totalDisponibility" for="totalDisponibility" align="center">DISPONIBILIDAD: 0</h6>					
							</div>
							<div class="col-4" >
								<h6  id="totalBalance" for="totalBalance">SALDO: 0</h6>										
							</div>
						</div>
					</div>
					</div>
				</div>  
				<div  class="container-fluid mb-3" style="float:left">
					<div class="card" >
					<div class="card-header " id="divTabDispoText"><i class="fas fa-table mr-1" ></i>Lista de movimientos disponibilidad del presupuesto de</div>
						<div class="card-body" >
							<div class="table-responsive">
								<table class="table table-bordered dataTable" id="dataTableDispo" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">
									
									<thead>
										<tr>
											<th>Número</th>	
											<th>Descripción</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Fecha</th>
											<th>Acciones</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Número</th>	
											<th>Descripción</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Fecha</th>
											<th>Acciones</th>
										</tr>
									</tfoot>
									</table>
							</div>
						</div>
					</div>
				</div> 	
				<br>
				<br>
				<div class="form-row mb-2">
					<div id="divInitialBudget" >
						<button type="button" onclick="createDisponibility(1)"   class="btn btn-primary">Guardar disponibilidad</button>
						<button type="button" onclick="createDisponibility(2)" class="btn btn-primary">Guardar y generar registro</button>
						<button type="button" onclick="cancels(2)"  class="btn btn-secondary">Cancelar</button>
					</div>					
				</div>  
			</form>
		</div>	
	</div>
	 

</div>
<div id="divRegister" class="container-fluid" style="display:none">
	<div class="card mb-4">
		<div class="card-header"><i class="fas fa-table mr-1"></i>Agregar registro</div>
		<div class="card-body">
				<div class="form-row">
					<div class="col-6">
						<label>Número de registro:</label>
						<input type="number" name="registerNumber" id="registerNumber" class="form-control" placeholder="Número de registro" >
					</div>
					<div class="col-6">
						<label>Fecha de registro:</label>				  
						<input name="dateRegister" id="dateRegister" type="date" class="form-control" >
					</div>
				</div>
				<br>
				<div class="form-row">
					<div class="col-6" >
						<label id="labelGetDisponibility">Disponibilidad:</label><button type="button" onclick="getDisponibilitysRg()" id="buttonGetDisponibility" data-toggle="modal" data-target="#myModalDisponibilityOrigin" class="btn btn-primary btn-sm" style="font-size:16px"><i class="fa fa-search-plus"></i></button>
						<select class="form-control" id="disponibilitySelectRegister" >
						</select>
					</div>	
					<div class="col-6" >
						<label>Terceros:</label><button type="button" onclick="getThirdsRg()" data-toggle="modal" data-target="#myModalThirds" class="btn btn-primary btn-sm" style="font-size:16px"><i class="fa fa-search-plus"></i></button>
						<select class="form-control" id="terceroSelectRegister" >
						</select>
					</div>					
				</div>
				<div class="form-row">
					<div class="col-6" >
						<label>Tipo de contrato o pago:</label>
						<select class="form-control" id="typeContract" >
						</select>
					</div>					
				</div>
				<br>
				<div class="form-row">
					<div class="col-6">
						<label for="exampleFormControlTextarea1">Observación:</label>
						<textarea placeholder="Observación" name="observationRegister" class="form-control" id="observationRegister" rows="3"></textarea>
					</div>					
				</div>	
				<br>
				<div  class="container-fluid mb-3" style="float:left">
					<div class="card" >
					<div class="card-header" id="textTableRubrosRegister"><i class="fas fa-table mr-1" ></i>Rubros de registro de</div>
						<div class="card-body" >
							<div class="table-responsive">
								<table class="table table-bordered dataTable" id="dataTableRegister" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">
									
									<thead>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Valor Disponibilidad</th>
											<th>Valor registro</th>
											<th>Saldo</th>
											<th>Acciones</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Valor Disponibilidad</th>
											<th>Valor registro</th>
											<th>Saldo</th>
											<th>Acciones</th>
										</tr>
									</tfoot>
									</table>
							</div>
							<div class="form-row col-12 mb-2">
						
								<div class="col-8" >
									<h6  id="totalRegisterBalance" for="totalRegisterBalance" align="center">REGISTRO: 0</h6>																							
								</div>
								<div class="col-4" >
									<h6  id="totalRegister" for="totalRegister">SALDO: 0</h6>
								</div>
							</div>	
						</div>
					</div>
				</div>
				<div  class="container-fluid mb-3" style="float:left">
					<div class="card" >
					<div class="card-header" id="divTabRegisterText"><i class="fas fa-table mr-1" ></i>Lista de registros realizados del presupuesto de</div>
						<div class="card-body" >
							<div class="table-responsive">
								<table class="table table-bordered dataTable" id="dataTableGetRegisters" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">
									
									<thead>
										<tr>
											<th>Registro</th>	
											<th>Descripción</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Fecha</th>
											<th>Acciones</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Registro</th>	
											<th>Descripción</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Fecha</th>
											<th>Acciones</th>
										</tr>
									</tfoot>
									</table>
							</div>
						</div>
					</div>
				</div>		
				<div class="form-row">
					<div>
						<button onclick="createRegister(1)" type="button" class="btn btn-primary">Guardar registro</button>
						<button onclick="createRegister(2)" type="button" class="btn btn-primary">Guardar y generar obligación</button>
						<button type="button" onclick="cancels(3)" class="btn btn-secondary">Cancelar</button>
					</div>					
				</div>  
		</div>	
	</div>
</div>
<div id="divObligation" class="container-fluid" style="display:none">
	<div class="card mb-4">
		<div class="card-header"><i class="fas fa-table mr-1"></i>Agregar Obligación</div>
		<div class="card-body">
				<div class="form-row">
					<div class="col-6">
						<label>Número de obligación:</label>
						<input type="number" name="numberObligation" id="numberObligation" class="form-control" placeholder="Número de registro" >
					</div>
					<div class="col-6">
						<label>Fecha de obligación:</label>				  
						<input name="dateObligation" id="dateObligation" type="date" class="form-control" >
					</div>
				</div>
				<br>
				<div class="form-row">
					<div class="col-6">
						<label id="labelRegisterSelectObligation">Registro:</label><button id="buttonRegisterSelectObligation" type="button" onclick="getRegistersOB()" data-toggle="modal" data-target="#myModalRegister" class="btn btn-primary btn-sm" style="font-size:16px"><i class="fa fa-search-plus"></i></button>
						<select class="form-control" name="registerObligation" id="registerObligation" >
						</select>
					</div>		
					<div class="col-6" >
						<label id="ThirdsToObligation">Terceros:</label><button type="button"  id="buttonThirdSelectObligation" onclick="getThirdsRg()" data-toggle="modal" data-target="#myModalThirds" class="btn btn-primary btn-sm" style="font-size:16px"><i class="fa fa-search-plus"></i></button>
						<select class="form-control" name="terceroSelectObligation" id="terceroSelectObligation" >
						</select>
					</div>					
				</div>
				<br>		
				<div class="form-row">
					<div class="col-6" >
						<label class="checkbox-inline">Sección de derechos economicos o personales
							<input style=" width: 30px; height: 30px; " type="checkbox" value="">
						</label>
						</select>
					</div>					
				</div>
				<br>
				<div class="form-row">
					<div class="col-6">
						<label for="exampleFormControlTextarea1">Observación:</label>
						<textarea placeholder="Observación" name="observationObligation" class="form-control" id="observationObligation" rows="3"></textarea>
					</div>					
				</div>	
				<br>
				<div  class="container-fluid mb-3" style="float:left">
					<div class="card" >
					<div class="card-header" id="textTableRubrosObligText"><i class="fas fa-table mr-1" ></i>Rubros de obligación</div>
						<div class="card-body" >
							<div class="table-responsive">
								<table class="table table-bordered dataTable" id="dataTableObligation" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">
									
									<thead>
										<tr>
											<th>Rubro</th>	
											<th>Inputación</th>
											<th>Valor Registro</th>
											<th>Valor Obligación</th>
											<th>Saldo Registro</th>
											<th>Acciones</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Rubro</th>	
											<th>Inputación</th>
											<th>Valor Registro</th>
											<th>Valor Obligación</th>
											<th>Saldo Registro</th>
											<th>Acciones</th>
										</tr>
									</tfoot>
									</table>
							</div>
							<div class="form-row col-12 mb-2">
								<div class="col-8" >
									<h6  id="totalObligationBalance" for="totalObligationBalance" align="center">OBLIGACIÓN: 0</h6>
								</div>
								<div class="col-4" >
									<h6  id="totalObligation" for="totalObligation">SALDO: 0</h6>														
								</div>								
							</div>	
						</div>
					</div>
					<br>
					<br>
					<div  class="container-fluid mb-3" style="float:left">
						<div class="card" >
						<div class="card-header" ><i class="fas fa-table mr-1" ></i>Ingreso datos contables</div>
							<div class="card-body" >
								<div class="table-responsive">
									<table class="table table-bordered dataTable" id="dataTableGetAccountsObligation" cellspacing="0" 
										role="grid" aria-describedby="dataTable_info">
										
										<thead>
											<tr>
												<th>Código</th>	
												<th>Descripción</th>
												<th>Tipo de cuenta</th>
												<th>Documento</th>
												<th>Valor</th>
												<th>Acciones</th>
											</tr>
										</thead>
										<tfoot>
											<tr>
												<th>Código</th>	
												<th>Descripción</th>
												<th>Tipo de cuenta</th>
												<th>Documento</th>
												<th>Valor</th>
												<th>Acciones</th>
											</tr>
										</tfoot>
										</table>
								</div>
							</div>
						</div>
					</div>	
				</div>		
				<div  class="container-fluid mb-3" style="float:left">
					<div class="card" >
					<div class="card-header" id="divTabObligationText"><i class="fas fa-table mr-1" ></i>Lista de obligaciones realizadas del presupuesto de</div>
						<div class="card-body" >
							<div class="table-responsive">
								<table class="table table-bordered dataTable" id="dataTableGetObligation" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">
									
									<thead>
										<tr>
											<th>Obligación</th>	
											<th>Descripción</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Fecha</th>
											<th>Acciones</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Obligación</th>	
											<th>Descripción</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Fecha</th>
											<th>Acciones</th>
										</tr>
									</tfoot>
									</table>
							</div>
						</div>
					</div>
				</div>
					
				<div class="form-row">
					<div >
						<button onclick="createObligation(1)" type="button" class="btn btn-primary">Guardar obligación</button>
						<button onclick="createObligation(2)" type="button" class="btn btn-primary">Guardar y generar comprobante de pago</button>
						<button type="button" onclick="cancels(4)" class="btn btn-secondary">Cancelar</button>
					</div>					
				</div>  
		</div>	
	</div>
</div>
<div id="divVoucherPayment" class="container-fluid" style="display:none">
	<div class="card mb-4">
		<div class="card-header"><i class="fas fa-table mr-1"></i>Generar comprobante de pago</div>
		<div class="card-body">
				<div class="form-row">
					<div class="col-6">
						<label>Número de comprobante de pago:</label>
						<input type="number" name="numberVoucherPayment" id="numberVoucherPayment" class="form-control" placeholder="Número de comprobante de pago" >
					</div>
					<div class="col-6">
						<label>Fecha de comprobante de pago:</label>				  
						<input name="dateVoucherPayment" id="dateVoucherPayment" type="date" class="form-control" >
					</div>
				</div>
				<br>
				<div class="form-row">
					<div class="col-6" >
						<label>Obligación: </label><button type="button" onclick="getObligationVoucher()" data-toggle="modal" data-target="#myModalObligation" class="btn btn-primary btn-sm" style="font-size:16px"><i class="fa fa-search-plus"></i></button>
						<select class="form-control" name="selectObligationVoucher" id="selectObligationVoucher" >
						</select>
					</div>		
					<div class="col-6" >
						<label>Terceros:</label><button type="button" onclick="getThirdsRg()" data-toggle="modal" data-target="#myModalThirds" class="btn btn-primary btn-sm" style="font-size:16px"><i class="fa fa-search-plus"></i></button>
						<select class="form-control" name="terceroSelectVoucher" id="terceroSelectVoucher" >
						</select>
					</div>					
				</div>
				<br>		
				<div class="form-row">
					<div class="col-6" >
						<label>Tipo de documento:</label><button type="button"  class="btn btn-primary btn-sm" style="font-size:16px"><i class="fa fa-search-plus"></i></button>
						<select class="form-control" name="typeDocument" id="typeDocument" >
						</select>
					</div>						

					<div class="col-6">
						<label for="exampleFormControlTextarea1">Observación:</label>
						<textarea placeholder="Observación" name="observationVoucherPayment" class="form-control" id="observationVoucherPayment" rows="3"></textarea>
					</div>					
				</div>	
				<br>					
				<div class="form-row">
					<div>
						<button onclick="createObligation(1)" type="button" class="btn btn-primary">Guardar comprobante de pago</button>
						<button type="button" class="btn btn-secondary">Cancelar</button>
					</div>					
				</div>  
		</div>	
	</div>
</div>
<div class="modal fade bd-example-modal-lg" id="myModalRubroOrigin" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Lista de rubros para seleccionar</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid" >
						<div class="card" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Rubros</div>
						<div class="card-body" >
							<div class="table-responsive">
								<font size="2" face="Arial" >

								<table style="width:70%" class="table table-bordered dataTable " id="dataTableSelectRubro" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">	
									<thead>
										<tr>
											<th>ID</th>	
											<th>Rubro</th>
											<th>Descripción</th>
											<th>Presupuesto inicial</th>
											<th>Presupuesto real</th>
											<th>Presupuesto por ejecutar</th>
											<th>Seleccionar</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>ID</th>	
											<th>Rubro</th>
											<th>Descripción</th>
											<th>Presupuesto inicial</th>
											<th>Presupuesto real</th>
											<th>Presupuesto por ejecutar</th>
											<th>Seleccionar</th>
										</tr>
									</tfoot>
										<tbody>
											<h1></h1>
										</tbody>
									</table>
								</font>
	
							</div>	
							</div>
						</div>
					</div> 
                </div>
            </div>         
        </div>  
</div>

<div class="modal fade bd-example-modal-lg" id="myModalDetall" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Detalles de la disponibilidad</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Detalles de rubros implicados</div>
						<div class="card-body" >
							<div class="table-responsive">

								<table class="table table-bordered dataTable" id="datatableDetalles" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">	
									<thead>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Disponibilidad</th>
											<th>Presupuesto disponible</th>
											<th>Saldo</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Disponibilidad</th>
											<th>Presupuesto disponible</th>
											<th>Saldo</th>
										</tr>
									</tfoot>
										<tbody>
											<h1></h1>
										</tbody>
									</table>

							</div>
							<div class="form-row col-12 mb-2">
						
								<div class="col-4" >
									<h6  id="totalBalanceDetall" for="totalBalanceDetall">SALDO: 0</h6>														
								</div>
								<div class="col-8" >
									<h6  id="totalDisponibilityDetall" for="totalDisponibilityDetall" align="center">DISPONIBILIDAD: 0</h6>
								</div>
							</div>		
							</div>
						</div>
					</div> 
                </div>
            </div>         
        </div>  
</div>

<div class="modal fade bd-example-modal-lg" id="myModalDisponibilityOrigin" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Lista de disponibilidades</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Disponibilidades</div>
						<div class="card-body" >
							<div class="table-responsive">
					
								<table class="table table-bordered dataTable " id="dataTableSelectDisponibility" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">	
									<thead>
										<tr>
											<th>Disponibilidad</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Fecha</th>
											<th>Descripción</th>
											<th>Seleccionar</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Disponibilidad</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Fecha</th>
											<th>Descripción</th>
											<th>Seleccionar</th>
										</tr>
									</tfoot>
										<tbody>
											<h1></h1>
										</tbody>
									</table>
									
							</div>	
							</div>
						</div>
					</div> 
                </div>
            </div>         
        </div>  
</div>
<div class="modal fade bd-example-modal-lg" id="myModalObligation" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Lista de obligaciones</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Obligaciones</div>
						<div class="card-body" >
							<div class="table-responsive">
					
								<table class="table table-bordered dataTable " id="dataTableSelectObligation" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">	
									<thead>
										<tr>
											<th>Obligación</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Fecha</th>
											<th>Descripción</th>
											<th>Seleccionar</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Obligación</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Fecha</th>
											<th>Descripción</th>
											<th>Seleccionar</th>
										</tr>
									</tfoot>
										<tbody>
											<h1></h1>
										</tbody>
									</table>
									
							</div>	
							</div>
						</div>
					</div> 
                </div>
            </div>         
        </div>  
</div>

<div class="modal fade bd-example-modal-lg" id="myModalRegister" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Lista de registro</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Registros</div>
						<div class="card-body" >
							<div class="table-responsive">
					
								<table class="table table-bordered dataTable " id="dataTableSelecRegister" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">	
									<thead>
										<tr>
											<th>Registro</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Fecha</th>
											<th>Descripción</th>
											<th>Seleccionar</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Disponibilidad</th>
											<th>Valor</th>
											<th>Saldo</th>
											<th>Fecha</th>
											<th>Descripción</th>
											<th>Seleccionar</th>
										</tr>
									</tfoot>
										<tbody>
											<h1></h1>
										</tbody>
									</table>
									
							</div>	
							</div>
						</div>
					</div> 
                </div>
            </div>         
        </div>  
</div>

<div class="modal fade bd-example-modal-lg" id="myModalThirds" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Lista de terceros</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Terceros</div>
						<div class="card-body" >
							<div class="table-responsive">
								<button class="genric-btn primary small" onclick="viewFormThirds()"  data-toggle="modal" data-target="#myModalCreateThird">Crear terceros</button>  
								<table class="table table-bordered dataTable " id="dataTableThirds" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">	
									<thead>
										<tr>
											<th>Nombre</th>
											<th>Apellido</th>
											<th>Tipo de identificación</th>
											<th>Identificación</th>
											<th>Teléfono</th>
											<th>Seleccionar</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Nombre</th>
											<th>Apellido</th>
											<th>Tipo de identificación</th>
											<th>Identificación</th>
											<th>Teléfono</th>
											<th>Seleccionar</th>
										</tr>
									</tfoot>
										<tbody>
											<h1></h1>
										</tbody>
									</table>
									
							</div>	
							</div>
						</div>
					</div> 
                </div>
            </div>         
        </div>  
</div>

<div class="modal fade" id="myModalCreateThird" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Añadir nuevo tercero</h4>
            </div>
                <div class="modal-body">
                    <div  class="container-fluid">
                        <form id="addThird" action="">
                            {% csrf_token %}
                            {% bootstrap_form thirdForm %}

                            <div id="divCreateThird"  class="form-group">
                                <button id="btnCreatenThird" type="button" onclick="submitThird()" class="genric-btn success circle" >Registrar Tercero</button>
                                <button type="button"  onclick="cancels(1)" class="genric-btn default circle" data-dismiss="modal">Cancelar</button>
                            </div>   
                    
                        </form>  
                    </div>
                </div>
            </div>         
        </div>  
</div>

<div class="modal fade bd-example-modal-lg" id="myModalRubroImplicado" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Rubro implicado en disponibilidad</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Rubros implicados</div>
						<div class="card-body" >
							<div class="table-responsive">
								<div class="mb-2" id="finishUpdateRID">
									<button  onclick="getFinishProcessUpdateRID()" data-toggle="modal" data-target="#myModalRubroImplicado"  class="genric-btn primary small">Terminar Actualización</button>
								</div>
								<table class="table table-bordered dataTable" id="datatableRubroImplicadoDisponibility" cellspacing="0" 
									role="grid" aria-describedby="dataTable_rubroImplicado">	
									<thead>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Disponibilidad</th>
											<th>Presupuesto disponible</th>
											<th>Saldo</th>
											<th>Acciones</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Disponibilidad</th>
											<th>Presupuesto disponible</th>
											<th>Saldo</th>
											<th>Acciones</th>

										</tr>
									</tfoot>
										<tbody>
											<h1></h1> 
							
										</tbody>

									</table>

							</div>
							<div class="form-row col-12 mb-2">
						
								<div class="col-4" >
									<h6  id="totalBalanceRID" for="totalBalanceRID">SALDO: 0</h6>														
								</div>
								<div class="col-8" >
									<h6  id="totalDisponibilityRID" for="totalDisponibilityRID" align="center">DISPONIBILIDAD: 0</h6>
								</div>
							</div>		
							</div>
						</div>
					</div> 
                </div>
            </div>         
        </div>  
</div>

<div class="modal fade bd-example-modal-lg" id="myModalDetailRegister" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Detalles de registros</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Detalles de Rubros implicados</div>
						<div class="card-body" >
							<div class="table-responsive">

								<table class="table table-bordered dataTable" id="datatableDetailRegister" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">	
									<thead>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Valor Disponibilidad</th>
											<th>Valor Registro</th>
											<th>Saldo</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Valor Disponibilidad</th>
											<th>Valor Registro</th>
											<th>Saldo</th>
										</tr>
									</tfoot>
										<tbody>
											<h1></h1>
										</tbody>
									</table>

							</div>
							<div class="form-row col-12 mb-2">
								<div class="col-8" >
									<h6  id="totalBalanceDetailRegister" for="totalBalanceDetailRegister" align="center">REGISTRO: 0</h6>
								</div>
								<div class="col-4" >
									<h6  id="totalDetailRegister" for="totalDetailRegister">SALDO: 0</h6>														
								</div>			
							</div>		
							</div>
						</div>
					</div> 
                </div>
            </div>         
        </div>              
</div>
<div class="modal fade bd-example-modal-lg" id="myModalRubroImplicadoRegister" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Rubro implicado en registro</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Rubros implicados</div>
						<div class="card-body" >
							<div class="table-responsive">
								<div class="mb-2" id="finishUpdateRIRegist">
									<button  onclick="getFinishProcessUpdateRIRegist()" data-toggle="modal" data-target="#myModalRubroImplicado"  class="genric-btn primary small">Terminar Actualización</button>
								</div>
								<table class="table table-bordered dataTable" id="datatableRubroImplicadoRegister" cellspacing="0" 
									role="grid" aria-describedby="dataTable_rubroImplicadoRegister">	
									<thead>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Valor Disponibilidad</th>
											<th>Valor Registro</th>
											<th>Saldo</th>
											<th>Acciones</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Valor Disponibilidad</th>
											<th>Valor Registro</th>
											<th>Saldo</th>
											<th>Acciones</th>

										</tr>
									</tfoot>
										<tbody>
											<h1></h1> 
							
										</tbody>

									</table>

							</div>
							<div class="form-row col-12 mb-2">
								<div class="col-8" >
									<h6  id="totalRegisterDR" for="totalRegisterDR" align="center">REGISTRO: 0</h6>
								</div>
								<div class="col-4" >
									<h6  id="totalBalanceDR" for="totalBalanceDR">SALDO: 0</h6>														
								</div>	
							</div>		
							</div>
						</div>
					</div>  
                </div>
            </div>         
        </div>  
</div>
<div class="modal fade bd-example-modal-lg" id="myModalDetailObligation" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Detalles de obligaciones</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Detalles de Rubros implicados en obligación</div>
						<div class="card-body" >
							<div class="table-responsive">

								<table class="table table-bordered dataTable" id="datatableDetailObligation" cellspacing="0" 
									role="grid" aria-describedby="dataTable_info">	
									<thead>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Valor Disponibilidad</th>
											<th>Valor Registro</th>
											<th>Saldo</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Valor Disponibilidad</th>
											<th>Valor Registro</th>
											<th>Saldo</th>
										</tr>
									</tfoot>
										<tbody>
											<h1></h1>
										</tbody>
									</table>

							</div>
							<div class="form-row col-12 mb-2">
								<div class="col-8" >
									<h6  id="totalBalanceDetailObligation" for="totalBalanceDetailObligation" align="center">OBLIGACIÓN: 0</h6>
								</div>
								<div class="col-4" >
									<h6  id="totalDetailObligation" for="totalDetailObligation">SALDO: 0</h6>														
								</div>
							</div>		
							</div>
						</div>
					</div> 
                </div>      
            </div>         
        </div>              
</div>
<div class="modal fade bd-example-modal-lg" id="myModalRubroImplicadoObligation" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Rubro implicado en obligación</h4>
            </div>
                <div class="modal-body">
					<div  class="container-fluid " >
						<div class="card mb" >
						<div class="card-header " ><i class="fas fa-table mr-1" ></i>Rubros implicados</div>
						<div class="card-body" >
							<div class="table-responsive">
								<div class="mb-2" id="finishUpdateRIOblig">
									<button  onclick="getFinishProcessUpdateRIOblig()" data-toggle="modal" data-target="#myModalRubroImplicado"  class="genric-btn primary small">Terminar Actualización</button>
								</div>
								<table class="table table-bordered dataTable" id="datatableRubroImplicadoObligation" cellspacing="0" 
									role="grid" aria-describedby="dataTable_rubroImplicadoObligation">	
									<thead>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Valor Disponibilidad</th>
											<th>Valor Registro</th>
											<th>Saldo</th>
											<th>Acciones</th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th>Rubro</th>	
											<th>Descripción</th>
											<th>Valor Disponibilidad</th>
											<th>Valor Registro</th>
											<th>Saldo</th>
											<th>Acciones</th>

										</tr>
									</tfoot>
										<tbody>
											<h1></h1> 
							
										</tbody>

									</table>

							</div>
							<div class="form-row col-12 mb-2">
								<div class="col-8" >
									<h6  id="totalObligation" for="totalObligation" align="center">OBLIGACIÓN: 0</h6>
								</div>
								<div class="col-4" >
									<h6  id="totalBalanceObligation" for="totalBalanceObligation">SALDO: 0</h6>														
								</div>
							</div>		
							</div>
						</div>  
					</div>  
                </div>
            </div>         
        </div>  
</div>

<script>

var originID=0;
var rubrosToOperation=[];
var addDisponibility=[];
var indexTable;
var totalOperate=0;
var totalOperateArray=[];
var totalDisponibility=0;
var oTable;
var addRegister=[];
var totalRegister=0;
var totalOperateRegister=0;
var totalOperateArrayRegister=[];
var addObligation=[];
var totalObligation=0;
var totalOperateObligation=0;
var totalOperateArrayObligation=[];
var disponibilitySec;
var registerSec;
var accountsWithValues =[] 
var arrayIdAccount=[]
var dateValidation;
var dateValidationR;

var disponibilityID;

$(document).ready(function() {
		$('#dataTableTest').DataTable( {
			"columnDefs": [
            {
                "targets": [ 0 ],
                "visible": false
            }
        ]
		,
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#dataTableSelectDisponibility').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#dataTableSelecRegister').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#dataTableObligation').DataTable( { 
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#dataTableGetObligation').DataTable( { 
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#dataTableGetRegisters').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#dataTableGetAccountsObligation').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#dataTableThirds').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );$(document).ready(function() {
		$('#dataTableRegister').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#dataTableDispo').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#datatableDetalles').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#dataTableSelectRubro').DataTable( {
			"ordering": false,
			"columnDefs": [
            {
                "targets": [ 0 ],
                "visible": false
            }
        ],
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#datatableRubroImplicadoDisponibility').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#datatableRubroImplicadoRegister').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#datatableDetailRegister').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#datatableDetailObligation').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );
$(document).ready(function() {
		$('#datatableRubroImplicadoObligation').DataTable( {
			
		  "destroy":true,
		  "language": idioma_español,
		  
			dom: 'Bfrtip',			
		  }
		  );		 	
} );

function loadTest() {	
	$.ajax({
		url: '{% url "getVoucher"  0 %}'.replace('0', localStorage.getItem('userID')),
		data: {
			'option': '1',
			'idBussines': localStorage.getItem('idBussines'),
		},
		dataType: 'json',
		success: function (data) {
		$('#separator')
				.append(`
				<div class="custom-control custom-radio custom-control-inline">
					<input  onclick="getRadioButon()" value="DISPONIBILIDAD" type="radio" class="custom-control-input" id="DISPONIBILIDAD" name="typeComprobante">
					<label class="custom-control-label" for="DISPONIBILIDAD">DISPONIBILIDAD</label>
				</div>
				<div class="custom-control custom-radio custom-control-inline">
					<input  onclick="getRadioButon()" value="REGISTRO" type="radio" class="custom-control-input" id="REGISTRO" name="typeComprobante">
					<label class="custom-control-label" for="REGISTRO">REGISTRO</label>
				</div>
				<div class="custom-control custom-radio custom-control-inline">
					<input onclick="getRadioButon()" value="OBLIGACIÓN" type="radio" class="custom-control-input" id="OBLIGACIÓN" name="typeComprobante">
					<label class="custom-control-label" for="OBLIGACIÓN">OBLIGACIÓN</label>
				</div>
				<div class="custom-control custom-radio custom-control-inline">
					<input  onclick="getRadioButon()" value="COMPROBANTEPAGO" type="radio" class="custom-control-input" id="COMPROBANTEPAGO" name="typeComprobante">
					<label class="custom-control-label" for="COMPROBANTEPAGO">COMPROBANTE DE PAGO</label>
				</div>`)
		for (var i=0; i<data.VH.length; i++){
			$('#separator')
			.append(`<div class="custom-control custom-radio custom-control-inline">
			<input onclick="getRadioButon()" type="radio" class="custom-control-input" value="`+data.VH[i].name+`" id="`+data.VH[i].name+`"name="typeComprobante">
			<label class="custom-control-label" for="`+data.VH[i].name+`">`+data.VH[i].name+`</label>
			</div>`)
			}
		}			
	});		
}
$('#dataTableTest tbody').on('click', 'tr', function () {	
	indexTable=$(this).index();
} );
$('#dataTableSelectRubro tbody').on('click', 'tr', function () {	
	indexTable=$(this).index();
} );
function getRadioButon(){

	if($('input[name=typeComprobante]:checked', '#addVoucher').val()=="DISPONIBILIDAD"){
		getVoucher();
	}
	if($('input[name=typeComprobante]:checked', '#addVoucher').val()=="REGISTRO"){
		getVoucher();

	}
	if($('input[name=typeComprobante]:checked', '#addVoucher').val()=="OBLIGACIÓN"){
		getVoucher();

	}
	if($('input[name=typeComprobante]:checked', '#addVoucher').val()=="COMPROBANTEPAGO"){
		getVoucher();

	}
	else{
		
	}
}

function generateButton(){
	var nameOrigin = $('input[name=origins]:checked', '#addVoucher').val();
	var nameVoucher = $('input[name=typeComprobante]:checked', '#addVoucher').val();

	if(nameVoucher=="DISPONIBILIDAD"){
		$("#divCreate").css("display", "none");
		
		$("#generator").text("GENERAR DISPONIBILIDAD DE PRESUPUESTO DE "+ nameOrigin)															
		$("#separatorButton").css("display", "block");
		$.ajax({
			url: '{% url "getVoucher"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'option': '3',
				'nameAC': localStorage.getItem('nameAC'),
				'idBussines': localStorage.getItem('idBussines'),
				'origin': nameOrigin
			},
			dataType: 'json',
			success: function (data) {
				originID = data.ID;
			}
		});
	}
	if(nameVoucher=="REGISTRO"){
		$("#divCreate").css("display", "none");
		$("#generator").text("GENERAR REGISTRO DE PRESUPUESTO DE "+ nameOrigin);
		$("#separatorButton").css("display", "block");
		$("#buttonGetDisponibility").css("display", "block");
		$('#disponibilitySelectRegister').attr('disabled', false);
		$("#labelGetDisponibility").text("Disponibilidad:");	
		$.ajax({
			url: '{% url "getVoucher"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'option': '3',
				'nameAC': localStorage.getItem('nameAC'),
				'idBussines': localStorage.getItem('idBussines'),
				'origin': nameOrigin
			},
			dataType: 'json',
			success: function (data) {
				originID = data.ID;
			}
		});																	
	}
	if(nameVoucher=="OBLIGACIÓN"){
		$('#registerObligation').prop('disabled', false);
		$('#terceroSelectObligation').prop('disabled', false);
		$("#buttonRegisterSelectObligation").css("display", "block");     
		$("#buttonThirdSelectObligation").css("display", "block");
		$("#labelRegisterSelectObligation").text("Registro:");
		$("#divCreate").css("display", "none");
		$("#generator").text("GENERAR OBLIGACIÓN DE PRESUPUESTO DE "+ nameOrigin);
		$("#separatorButton").css("display", "block");
		$('#registerObligation').prop('enable', 'enable');
		$('#terceroSelectObligation').prop('enable', 'enable');
		$("#buttonRegisterSelectObligation").css("display", "block");     
		$("#buttonThirdSelectObligation").css("display", "block");
		$("#labelRegisterSelectObligation").text("Registro:");
		$("#ThirdsToObligation").text("Terceros:");															

		$.ajax({
			url: '{% url "getVoucher"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'option': '3',
				'nameAC': localStorage.getItem('nameAC'),
				'idBussines': localStorage.getItem('idBussines'),
				'origin': nameOrigin
			},
			dataType: 'json',
			success: function (data) {
				originID = data.ID;
			}
		});																	
	}
	if(nameVoucher=="COMPROBANTEPAGO"){
		$("#divCreate").css("display", "none");
		$("#generator").text("GENERAR COMPROBANTE DE PAGO DE PRESUPUESTO DE "+ nameOrigin);
		$("#separatorButton").css("display", "block");
		$.ajax({
			url: '{% url "getVoucher"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'option': '3',
				'nameAC': localStorage.getItem('nameAC'),
				'idBussines': localStorage.getItem('idBussines'),
				'origin': nameOrigin
			},
			dataType: 'json',
			success: function (data) {
				originID = data.ID;
			}
		});																	
	}
	else{
		
	}	
}

function getVoucher(){
	$.ajax({
		url: '{% url "getVoucher"  0 %}'.replace('0', localStorage.getItem('userID')),
		data: {
			'option': '2',
			'nameAC': localStorage.getItem('nameAC'),
			'idBussines': localStorage.getItem('idBussines'),

		},
		dataType: 'json',
		success: function (data) {
			$("#separatorOP").empty()
			for (var i=0; i<data.OR.length; i++){
				$('#separatorOP')
				.append(`<div class="custom-control custom-radio custom-control-inline">
				<input type="radio" onclick="generateButton()" class="custom-control-input" value="`+data.OR[i].nameOrigin+`" id="`+data.OR[i].nameOrigin+`"name="origins">
				<label class="custom-control-label" for="`+data.OR[i].nameOrigin+`">`+data.OR[i].nameOrigin+`</label>
				</div>`)
				}   
			}			
		});	
}

function getRubrosByOrigin(){
	$.ajax({
			url: '{% url "getRubrosOrigin" 0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				var table = $('#dataTableSelectRubro').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RUBRO.length; i++){

				table.row.add( [
				data.RUBRO[i].id,
				data.RUBRO[i].rubro,
				data.RUBRO[i].description,
				data.RUBRO[i].initialBudget,
				data.RUBRO[i].realBudget,
				data.RUBRO[i].budgetEject,
				"<a data-toggle='tooltip' title='Seleccionar rubro'><button  id="+JSON.stringify(data.RUBRO[i].id)+" onclick=\'getRubroByDisponibilty("+JSON.stringify(data.RUBRO[i].id)+','+ JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].description)+','+JSON.stringify(data.RUBRO[i].budgetEject)+','+JSON.stringify(data.RUBRO[i].typeRubro)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"														
				])
			}
			table.draw( false );
			}
		});
}

function validaNumericos(event) {
    if(event.charCode >= 48 && event.charCode <= 57){
      return true;
     }
     return false;        
}

function getRubroByDisponibilty(id,rubro,description,budgetEject,typeRubro){
	if(rubrosToOperation.includes("#balance"+id)){
		swal("Este rubro ya fue añadido", "No se puede añadir el mismo rubro", "error");
	}else{
		if(typeRubro=='A'){
		rubrosToOperation.push("#balance"+id);
		$('#myModalRubroOrigin').modal('toggle');
		var table = $('#dataTableTest').DataTable(); 
		table.row.add([
		id,
		rubro,
		description,
		"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'   id="+id+" class='form-control' name='inputOperations'>",
		budgetEject,
		"<label type='number' id=balance"+id+"></label>",
		"<a data-toggle='tooltip' title='Validar operación'><button  onclick='operateBalance("+id+','+rubro+','+budgetEject+','+ JSON.stringify(description)+")' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"+
		"<a data-toggle='tooltip' title='Eliminar rubro'><button onclick='deleteRubroSelected("+id+")' class='btn btn-primary btn-sm'><i class='fa fa-trash' aria-hidden='true'></i></button></a>"								
		]).node().id = rubro+"IDtr";
		table.draw(false);
	}else{
			swal("Este rubro es mayor", "No se puede añadir", "error");
		}
	}

}

function operateBalance(id,rubro,budgetEject,description){
	var createId =  "#"+id;
	var result= "#balance"+id
	var operate=0;
	var intBudget = parseInt(budgetEject);
	operate = budgetEject - parseInt($(createId).val());
	const found = addDisponibility.findIndex(element => element['id'] == id);
	if(found<0){

	if(operate<0){
			swal("El valor de "+ parseInt($(createId).val())+" es mayor a el valor del presupuesto actual de "+ intBudget, " No se puede realizar la disponibilidad", "error");
		}else{
			$(result).text(operate);
			addDisponibility.push({
				"id": id,
				"rubro": rubro,
				"description": description,
				"concept": "DISPONIBILIDAD",
				"value":parseInt($(createId).val()),
				"balance":operate,
				"realBudget": budgetEject
			})
			totalOperateArray.push({
				"id": id,
				"subtotal": operate,
				"disponibility":  parseInt($(createId).val())
			})
			totalOperate = totalOperate + operate;	
			totalDisponibility = totalDisponibility + parseInt($(createId).val());
			$("#totalBalance").text("SALDO: "+ totalOperate);														
			$("#totalDisponibility").text("DISPONIBILIDAD: "+ totalDisponibility);														

		}
		console.log(totalOperateArray)
		console.log(addDisponibility)
	}else{

		if(operate<0){
			swal("El valor de "+ parseInt($(createId).val())+" es mayor a el valor del presupuesto actual de "+ intBudget, " No se puede realizar la disponibilidad", "error");
		}else{
			$(result).text(operate);
			addDisponibility[found] ={
				"id": id,
				"rubro": rubro,
				"description": description,
				"concept": "DISPONIBILIDAD",
				"value":parseInt($(createId).val()),
				"balance":operate,
				"realBudget": budgetEject
			}
			totalOperate = totalOperate - totalOperateArray[found]['subtotal'];	
			totalDisponibility = totalDisponibility - totalOperateArray[found]['disponibility'];
			totalOperateArray[found] = {
				"id": id,
				"subtotal": operate,
				"disponibility":  parseInt($(createId).val())
			}
			totalOperate = totalOperate + totalOperateArray[found]['subtotal'];	
			totalDisponibility = totalDisponibility + totalOperateArray[found]['disponibility'];
			$("#totalBalance").text("PRESUPUESTO POR EJECUTAR: "+ totalOperate);														
			$("#totalDisponibility").text("VALOR: "+ totalDisponibility);														

		}
		console.log(totalOperateArray)
		console.log(addDisponibility)
	}


}

function deleteRubroSelected(id){
	
	var positionDelete;
	for (var i = 0; i < totalOperateArray.length; i++) {	
		if(totalOperateArray[i].id==id){
			positionDelete = i;
		}
	}

	oTable = $('#dataTableTest').DataTable();
	oTable.row(':eq('+indexTable +')').remove().draw();
	rubrosToOperation.splice(rubrosToOperation.indexOf(id), 1);
	addDisponibility.splice(addDisponibility.indexOf(id), 1);
	totalOperate = totalOperate - totalOperateArray[positionDelete].subtotal;
	totalDisponibility = totalDisponibility - totalOperateArray[positionDelete].disponibility;
	$("#totalBalance").text("SALDO: "+ totalOperate);	
	$("#totalDisponibility").text("DISPONIBILIDAD: "+ totalDisponibility);													
	totalOperateArray.splice(totalOperateArray.indexOf(id), 1);
}

$("form#createDisponibility").submit(function(e) {
	e.preventDefault()
});

function generateDisponibilty(){
	var nameVoucher = $('input[name=typeComprobante]:checked', '#addVoucher').val();
	var nameOrigin = $('input[name=origins]:checked', '#addVoucher').val();
	if(nameVoucher=="DISPONIBILIDAD"){
		$("#divCreate").css("display", "block");
		$("#divRegister").css("display", "none");
		$("#divObligation").css("display", "none");
		$("#divVoucherPayment").css("display", "none");
		
		var fecha = new Date(); //Fecha actual
		var mes = fecha.getMonth()+1; //obteniendo mes
		var dia = fecha.getDate(); //obteniendo dia
		var ano = fecha.getFullYear(); //obteniendo año
		if(dia<10)
			dia='0'+dia; //agrega cero si el menor de 10
		if(mes<10)
			mes='0'+mes //agrega cero si el menor de 10
		document.getElementById('date').value=ano+"-"+mes+"-"+dia;
		$.ajax({
				url: '{% url "getDisponibility" 0 %}'.replace('0', localStorage.getItem('userID')),
				data: {
					'bussines':localStorage.getItem('idBussines'),
					'origin': originID
				},
				dataType: 'json',
				success: function (data) {
					$("#divCreate").css("display", "block");
					$("#textTable").text("Lista de rubros por presupuesto de "+nameOrigin);
					$("#divTabDispoText").text("Lista de movimientos Disponibilidad del presupuesto de "+nameOrigin);
					$("#disponibilityIn").val(data.DI); 

					var table = $('#dataTableDispo').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.MV.length; i++){

						table.row.add( [
						data.MV[i].disponibility,
						data.MV[i].observation,
						data.MV[i].value,
						data.MV[i].balance,
						data.MV[i].date,
						"<a data-toggle='tooltip' title='Ver detalles de disponibilidad'><button onclick='getDetall("+data.MV[i].id+")' data-toggle='modal' data-target='#myModalDetall' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
						"<a data-toggle='tooltip'  id='deleteDisponibility' title='Eliminar disponibilidad'><button onclick=\'deleteDisponibility("+JSON.stringify(data.MV[i].id)+','+JSON.stringify(data.MV[i].disponibility)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
						"<a data-toggle='tooltip'  id='updateDisponibility' title='Actualizar disponibilidad'><button onclick=\'getRubroImplicadoDisp("+JSON.stringify(data.MV[i].id)+','+JSON.stringify(data.MV[i].disponibility)+")\' data-toggle='modal' data-target='#myModalRubroImplicado' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
				
						])
					}
					table.draw( false );		
				}
		});	
	}
	if(nameVoucher=="REGISTRO"){

		$("#divCreate").css("display", "none");
		$("#divRegister").css("display", "block");
		$("#divObligation").css("display", "none");
		$("#divVoucherPayment").css("display", "none");
		$("#textTableRubrosRegister").text("Rubros de registro de "+nameOrigin);
		$("#divTabRegisterText").text("Lista de registros realizados del presupuesto de "+nameOrigin);

		getDataToRegister();
	}
	if(nameVoucher=="OBLIGACIÓN"){

		$("#textTableRubrosObligText").text("Rubros de obligación de "+nameOrigin);
		$("#divTabObligationText").text("Lista de obligaciones realizadas del presupuesto de "+nameOrigin);

		getDataToObligation();
	}
	if(nameVoucher=="COMPROBANTEPAGO"){

		$("#divCreate").css("display", "none");
		$("#divRegister").css("display", "none");
		$("#divObligation").css("display", "none");
		$("#divVoucherPayment").css("display", "block");
		getDataToVoucherPayment();
	}
														
}

function createDisponibility(option){
	if(option==1){
		if(totalDisponibility==0){
		swal("No puede guardar una disponibilidad sin valores", "Por favor ingrese disponibilidades", "error");
	}else{
		swal({
        title: "Desea terminar la disponibilidad ?",
        text: "Al confirmar esta acción, la disponibilidad sera guardada",
        icon: "warning",
        buttons: true,
        dangerMode: true,
        }).then((willDelete) => {
        if (willDelete) {

			var disponibilityCode = $('input[name="disponibilityIn"]').val();
			var observation = $('textarea[name="observation"]').val();
			var date = $('input[name="date"]').val();
			if (disponibilityCode,observation,date) {
				// Create Ajax Call
				$.ajax({
					url: '{% url "createDisponibility"  0 %}'.replace('0', localStorage.getItem('userID')),
					data: {
						'bussines':localStorage.getItem('idBussines'), 
						'disponibilityCode': disponibilityCode,
						'origin': originID,
						'date': date,
						'observation': observation,
						'value':totalDisponibility,
						'balance': totalOperate,
						'disponibilitys': JSON.stringify(addDisponibility)
					},
					dataType: 'json',
					success: function (data) {
						$("#divCreate").css("display", "none");
						swal("Creado exitoso de la disponibilidad!", "Continua con tu proceso!", "success");
						$('textarea[name="observation"]').val("");
						addDisponibility.length=0;
						totalOperate=0;
						totalOperateArray.length=0;
						totalDisponibility=0;
						rubrosToOperation.length=0;
						var table = $('#dataTableTest').DataTable(); 
 						var rows = table.rows().remove().draw();
						$("#totalBalance").text("SALDO: "+ totalOperate);	
						$("#totalDisponibility").text("DISPONIBILIDAD: "+ totalDisponibility);	
					}
				});
			} else {
				alert("Por favor llene todos los campos");
			}
			return false;
        }
        });

	}}else{
		if(totalDisponibility==0){
		swal("No puede guardar una disponibilidad sin valores", "Por favor ingrese disponibilidades", "error");
		}else{
			swal({
			title: "Desea terminar la disponibilidad ?",
			text: "Al confirmar esta acción, la disponibilidad sera guardada",
			icon: "warning",
			buttons: true,
			dangerMode: true,
			}).then((willDelete) => {
			if (willDelete) {

				var disponibilityCode = $('input[name="disponibilityIn"]').val();
				var observation = $('textarea[name="observation"]').val();
				var date = $('input[name="date"]').val();
				if (disponibilityCode,observation,date) {
					// Create Ajax Call
					$.ajax({
						url: '{% url "createDisponibility"  0 %}'.replace('0', localStorage.getItem('userID')),
						data: {
							'bussines':localStorage.getItem('idBussines'), 
							'disponibilityCode': disponibilityCode,
							'origin': originID,
							'date': date,
							'observation': observation,
							'value':totalDisponibility,
							'balance': totalOperate,
							'disponibilitys': JSON.stringify(addDisponibility)
						},
						dataType: 'json',
						success: function (data) {
							$("#divCreate").css("display", "none");
							swal("Creado exitoso de la disponibilidad!", "Continua con tu proceso!", "success");
							$('textarea[name="observation"]').val("");
							addDisponibility.length=0;
							totalOperate=0;
							totalOperateArray.length=0;
							totalDisponibility=0;
							rubrosToOperation.length=0;
							var table = $('#dataTableTest').DataTable(); 
							var rows = table.rows().remove().draw();
							$("#totalBalance").text("SALDO: "+ totalOperate);	
							$("#totalDisponibility").text("DISPONIBILIDAD: "+ totalDisponibility);	
							$("#observationRegister").val(observation);
							$("#dateRegister").val(date); 
							dateValidation =  date;
							$('#disponibilitySelectRegister').prop('disabled', 'disabled');
							$("#buttonGetDisponibility").css("display", "none");
							$("#labelGetDisponibility").text("Disponibilidad:"+ data.DP);	
							var dateRegister = document.getElementById("dateRegister");
							dateRegister.value = date;
							getDataToRegister();
							selectDisponibiltyToRegister(JSON.stringify(data.ID));

						}
					});
				} else {
					alert("Por favor llene todos los campos");
				}
				return false;
			}
			});

		}
	}
}
function getDetall(id){
	var totalDetall=0;
	var totalDetallDisponibility=0;
	$.ajax({
			url: '{% url "getDetallsDisponibility"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'disponibility':id,
			},
			dataType: 'json',
			success: function (data) {
				
				var table = $('#datatableDetalles').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RUBRO.length; i++){

				table.row.add( [
				data.RUBRO[i].rubro,
				data.RUBRO[i].description,
				data.RUBRO[i].value,
				data.RUBRO[i].budgetEject,
				data.RUBRO[i].balance
				])
				totalDetall = totalDetall + data.RUBRO[i].balance;
				totalDetallDisponibility = totalDetallDisponibility + data.RUBRO[i].value;				
			}
			table.draw( false );

			$("#totalDisponibilityDetall").text("SALDO: "+ totalDetall);	
			$("#totalBalanceDetall").text("DISPONIBILIDAD: "+ totalDetallDisponibility);

		}
	});
}
function deleteDisponibility(id, numero){
  
	swal({
	title: "Desea eliminar disponibilidad número " + numero + "?",
	text: "Al confirmar esta acción, la disponibilidad número " + numero + " sera eliminado.",
	icon: "warning",
	buttons: true,
	dangerMode: true,
	})
	.then((willDelete) => {
	if (willDelete) {
	
		$.ajax({
			url: '{% url "deleteAll"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'origin': originID,
				'id': id,
				'option': '9'
			},
			dataType: 'json',
			success: function (data) { 
				if(data.Eliminado=='True'){
					var table = $('#dataTableDispo').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.MV.length; i++){

						table.row.add( [
						data.MV[i].disponibility,
						data.MV[i].observation,
						data.MV[i].value,
						data.MV[i].balance,
						data.MV[i].date,
						"<a data-toggle='tooltip' title='Ver detalles de disponibilidad'><button onclick='getDetall("+data.MV[i].id+")' data-toggle='modal' data-target='#myModalDetall' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
						"<a data-toggle='tooltip'  id='deleteDisponibility' title='Eliminar disponibilidad'><button onclick=\'deleteDisponibility("+JSON.stringify(data.MV[i].id)+','+JSON.stringify(data.MV[i].disponibility)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
						"<a data-toggle='tooltip'  id='updateDisponibility' title='Actualizar disponibilidad'><button onclick=\'getRubroImplicadoDisp("+JSON.stringify(data.MV[i].id)+','+JSON.stringify(data.MV[i].disponibility)+")\' data-toggle='modal' data-target='#myModalRubroImplicado' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
						])
					}
					table.draw( false );
					swal("La disponibilidad número " + numero + " se ha eliminado con éxito."," ","success");
				}else{
					swal("La disponibilidad número " + numero + " contiene registros."," ","error");
				}		  
			}
		});
	}
	});
}
function getRubroImplicadoDisp(id){

	var totalDetall=0;
	var totalDetallDisponibility=0;
	$.ajax({
			url: '{% url "getRubroImpDisponibility"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'disponibility':id,
			},
			
			dataType: 'json',
			
			success: function (data) {
				console.log(data)

				var table = $('#datatableRubroImplicadoDisponibility').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RUBRO.length; i++){

				table.row.add( [
				data.RUBRO[i].rubro,
				data.RUBRO[i].description,
				"<input type='text'     size='10' value="+data.RUBRO[i].value+"  id=valueDataUpdateID"+data.RUBRO[i].id+" class='form-control'>",
				data.RUBRO[i].budgetEject,
				data.RUBRO[i].balance,

				"<a data-toggle='tooltip'  id='deleteRID' title='Eliminar rubro implicado en disponibilidad'><button onclick=\'deleteRID("+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].dispoID)+','+JSON.stringify(id)+','+JSON.stringify(data.RUBRO[i].budgetEject)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
				"<a data-toggle='tooltip'  id='updateDisponibility' title='Actualizar rubro implicado en disponibilidad'><button onclick=\'updateRID("+JSON.stringify(data.RUBRO[i].dispoID)+','+id+','+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].value)+")\' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
				])
				totalDetall = totalDetall + data.RUBRO[i].balance;
				totalDetallDisponibility = totalDetallDisponibility + data.RUBRO[i].value;				
			}
			table.draw( false );

			$("#totalDisponibilityRID").text("SALDO: "+ totalDetall);	
			$("#totalBalanceRID").text("DISPONIBILIDAD: "+ totalDetallDisponibility);

		}
	});
}
function deleteRID(id, rubro,dispoID,disponibility,budgetEject){
	var totalDetall=0;
	var totalDetallDisponibility=0;
	swal({
	title: "Desea eliminar el rubro implicado en disponibilidad número " + rubro + "?",
	text: "Al confirmar esta acción, el rubro implicado en disponibilidad número " + rubro + " sera eliminado.",
	icon: "warning",
	buttons: true,
	dangerMode: true,
	})
	.then((willDelete) => {
	if (willDelete) {

		$.ajax({
			url: '{% url "deleteAll"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'id': id,
				'origin':  originID,
				'option': '12',
				'dispoID': dispoID,
				'budgetEject': parseInt(budgetEject),
				'disponibility': parseInt(disponibility)
			},
			dataType: 'json',
			success: function (data) {

				if(data.RUBRO.length==0){
						var table = $('#dataTableDispo').DataTable(); 
						var rows = table.rows().remove().draw();
						for (var i=0; i<data.MV.length; i++){

							table.row.add( [
							data.MV[i].disponibility,
							data.MV[i].observation,
							data.MV[i].value,
							data.MV[i].balance,
							data.MV[i].date,
							"<a data-toggle='tooltip' title='Ver detalles de disponibilidad'><button onclick='getDetall("+data.MV[i].id+")' data-toggle='modal' data-target='#myModalDetall' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
							"<a data-toggle='tooltip'  id='deleteDisponibility' title='Eliminar disponibilidad'><button onclick=\'deleteDisponibility("+JSON.stringify(data.MV[i].id)+','+JSON.stringify(data.MV[i].disponibility)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
							"<a data-toggle='tooltip'  id='updateDisponibility' title='Actualizar disponibilidad'><button onclick=\'getRubroImplicadoDisp("+JSON.stringify(data.MV[i].id)+','+JSON.stringify(data.MV[i].disponibility)+")\' data-toggle='modal' data-target='#myModalRubroImplicado' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
							])
						}
						table.draw( false );
						swal("El rubro implicado en disponibilidad número " + rubro + " y su disponibildad se ha eliminadon con éxito."," ","success");
						$('#myModalRubroImplicado').modal('toggle');

				}else{
					var table = $('#datatableRubroImplicadoDisponibility').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.RUBRO.length; i++){

					table.row.add( [
					data.RUBRO[i].rubro,
					data.RUBRO[i].description,
					data.RUBRO[i].value,
					data.RUBRO[i].budgetEject,
					data.RUBRO[i].balance,

					"<a data-toggle='tooltip'  id='deleteRID' title='Eliminar rubro implicado en disponibilidad'><button onclick=\'deleteRID("+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].dispoID)+','+JSON.stringify(id)+','+JSON.stringify(data.RUBRO[i].budgetEject)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
					"<a data-toggle='tooltip'  id='updateDisponibility' title='Actualizar rubro implicado en disponibilidad'><button onclick=\'updateRID("+JSON.stringify(data.RUBRO[i].dispoID)+','+id+','+JSON.stringify(data.RUBRO[i].value)+','+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].newValueOperated)+")\' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
					])
					totalDetall = totalDetall + data.RUBRO[i].balance;
					totalDetallDisponibility = totalDetallDisponibility + data.RUBRO[i].value;				
				}
				table.draw( false );

				$("#totalDisponibilityRID").text("SALDO: "+ totalDetall);	
				$("#totalBalanceRID").text("DISPONIBILIDAD: "+ totalDetallDisponibility);
				swal("El rubro implicado en disponibilidad número " + rubro + "  se ha eliminado con éxito."," ","success");
				}			
			}
		});
	}
	});
}


function updateRID(id,disponibility,rubroID,oldValue){

	var totalDetall=0;
	var totalDetallDisponibility=0;
	var oldValue;
	var valueDataUpdateID =  "#valueDataUpdateID"+rubroID; //ESTE ES EL VALOR nuevo
	var newValue =  parseInt($(valueDataUpdateID).val());
	var nameOrigin = $('input[name=origins]:checked', '#addVoucher').val();
	console.log(id)
	console.log(disponibility)
	console.log(oldValue)
	console.log(rubroID)
	console.log(valueDataUpdateID)
	console.log(newValue)

	if(oldValue > newValue){

		var newValueOperated = parseInt(oldValue) - parseInt(newValue);
		console.log(newValueOperated)
		$.ajax({
			url: '{% url "updateRID"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'id':id,
				'origin':  originID,
				'disponibility': disponibility,
				'rubroID': rubroID,
				'newValueOperated': newValueOperated,
				'oldValue': oldValue,
				'newValue': newValue,
			},
			
			dataType: 'json',
			
			success: function (data) {
				console.log(data)
				if(data.CREATE == "TRUE"){

					var table = $('#datatableRubroImplicadoDisponibility').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.RUBRO.length; i++){

					table.row.add( [
					data.RUBRO[i].rubro,
					data.RUBRO[i].description,
					"<input type='text'  onkeypress='return validaNumericos(event)'/  size='10' value="+data.RUBRO[i].value+"  id=valueDataUpdateID"+data.RUBRO[i].id+" class='form-control'>",
					data.RUBRO[i].budgetEject,
					data.RUBRO[i].balance,

					"<a data-toggle='tooltip'  id='deleteRID' title='Eliminar rubro implicado en disponibilidad'><button onclick=\'deleteRID("+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].dispoID)+','+JSON.stringify(id)+','+JSON.stringify(data.RUBRO[i].budgetEject)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
					"<a data-toggle='tooltip'  id='updateDisponibility' title='Actualizar rubro implicado en disponibilidad'><button onclick=\'updateRID("+JSON.stringify(data.RUBRO[i].dispoID)+','+id+','+JSON.stringify(data.RUBRO[i].value)+','+JSON.stringify(data.RUBRO[i].id)+")\' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
					])
					totalDetall = totalDetall + data.RUBRO[i].balance;
					totalDetallDisponibility = totalDetallDisponibility + data.RUBRO[i].value;				
					}
					table.draw( false );

					$("#totalDisponibilityRID").text("SALDO: "+ totalDetall);	
					$("#totalBalanceRID").text("DISPONIBILIDAD: "+ totalDetallDisponibility);    

					swal("Actualización exitosa!", "Continua con tu proceso!", "success");

					$("#textTable").text("Lista de rubros por presupuesto de "+nameOrigin);
					$("#divTabDispoText").text("Lista de movimientos Disponibilidad del presupuesto de "+nameOrigin);
					var tableListMovementDispo = $('#dataTableDispo').DataTable(); 
					var rows = tableListMovementDispo.rows().remove().draw();
					for (var i=0; i<data.TMVD.length; i++){

						tableListMovementDispo.row.add( [
						data.TMVD[i].disponibility,
						data.TMVD[i].observation,
						data.TMVD[i].value,
						data.TMVD[i].balance,
						data.TMVD[i].date,
						"<a data-toggle='tooltip' title='Ver detalles de disponibilidad'><button onclick='getDetall("+data.TMVD[i].id+")' data-toggle='modal' data-target='#myModalDetall' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
						"<a data-toggle='tooltip'  id='deleteDisponibility' title='Eliminar disponibilidad'><button onclick=\'deleteDisponibility("+JSON.stringify(data.TMVD[i].id)+','+JSON.stringify(data.TMVD[i].disponibility)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
						"<a data-toggle='tooltip'  id='updateDisponibility' title='Actualizar disponibilidad'><button onclick=\'getRubroImplicadoDisp("+JSON.stringify(data.TMVD[i].id)+','+JSON.stringify(data.TMVD[i].disponibility)+")\' data-toggle='modal' data-target='#myModalRubroImplicado' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
				
						])
					}
					tableListMovementDispo.draw( false );
					
				}else{
				
				} 	
			}
		});
	}else if(newValue <= 0){
		swal("El valor "+ parseInt(newValue)+" es mayor al valor del presupuesto actual "+ parseInt(newValue), " No se puede realizar la disponibilidad", "error");
	}
}

function getFinishProcessUpdateRID(){

	if(data.CREATE == "TRUE"){
		swal("Actualización exitosa!", "Continua con tu proceso!", "success");
	}else{
		swal("La Actualización no se pudo realizar!", "verificar tu operación y continua con tu proceso!", "success");
	}

}
//-----------------------parte de registro para no perderce-----------
function getDataToRegister(){
	$.ajax({
			url: '{% url "getDataToRegister"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				console.log(data)
				const $select = document.querySelector("#typeContract");
				const $selectTH = document.querySelector("#terceroSelectRegister");
				const $selectTC = document.querySelector("#disponibilitySelectRegister");

				for (let i = $select.options.length; i >= 0; i--) {
						$select.remove(i);
				}
				for (let i = $selectTC.options.length; i >= 0; i--) {
						$selectTC.remove(i);
				}
				for (let i = $selectTH.options.length; i >= 0; i--) {
						$selectTH.remove(i);
				}  

				$('#disponibilitySelectRegister').append(`<option  hidden  selected"> Selecciona una opción</option>`);
				$('#terceroSelectRegister').append(`<option  hidden  selected"> Selecciona una opción</option>`);
				$('#typeContract').append(`<option  hidden  selected"> Selecciona una opción</option>`);

				for (var i=0; i<data.MV.length; i++){
					$('#disponibilitySelectRegister').append('<option value='+data.MV[i].id+'>'+data.MV[i].disponibility+'</option>')
				}
				for (var i=0; i<data.TH.length; i++){
					$('#terceroSelectRegister').append('<option value='+data.TH[i].id+'>'+data.TH[i].name + " " +data.TH[i].surnames+'</option>')
				}
				for (var i=0; i<data.TC.length; i++){
					$('#typeContract').append('<option value='+data.TC[i].id+'>'+data.TC[i].nameTC+'</option>')
				}
				$("#divRegister").css("display", "block");

				var table = $('#dataTableGetRegisters').DataTable(); 
				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RG.length; i++){

					table.row.add( [
					data.RG[i].register,
					data.RG[i].observation,
					data.RG[i].value,
					data.RG[i].balance,
					data.RG[i].date,
					"<a data-toggle='tooltip' title='Ver detalles de registro'><button onclick='getDetailRegister("+data.RG[i].id+")' data-toggle='modal' data-target='#myModalDetailRegister' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
					"<a data-toggle='tooltip'  type='button'  title='Eliminar registro'><button onclick=\'deleteRegister("+JSON.stringify(data.RG[i].id)+','+JSON.stringify(data.RG[i].register)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
					"<a data-toggle='tooltip'  id='updateRegistro' title='Actualizar registro'><button onclick=\'getRubroImplicadoRD("+JSON.stringify(data.RG[i].id)+','+JSON.stringify(data.RG[i].register)+")\' data-toggle='modal' data-target='#myModalRubroImplicadoRegister' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
					
					])   
				}
				table.draw( false );

			}
	});
	$.ajax({
			url: '{% url "getRegisterSerial"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				$("#registerNumber").val(data.RE); 

			}
	});
}
function getDetailRegister(id){
	var totalDetailR=0;
	var totalDetailRegister=0;
	$.ajax({
			url: '{% url "getDetailRegister"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'register':id,
			},
			dataType: 'json',
			success: function (data) {
				
				var table = $('#datatableDetailRegister').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.DRG.length; i++){

				table.row.add( [

				data.DRG[i].rubro,
				data.DRG[i].description,
				data.DRG[i].value,
				data.DRG[i].budgetEject,
				data.DRG[i].balance
				
				])
				totalDetailR = totalDetailR + data.DRG[i].balance;
				totalDetailRegister = totalDetailRegister + data.DRG[i].value;				
			}
			table.draw( false );

			$("#totalDetailRegister").text("SALDO: "+ totalDetailR);	
			$("#totalBalanceDetailRegister").text("REGISTRO: "+ totalDetailRegister);

		}
	});
}
function deleteRegister(id, numero){
  
	swal({
	title: "Desea eliminar el registro con número " + numero + "?",
	text: "Al confirmar esta acción, el registro con número " + numero + " sera eliminado.",
	icon: "warning",
	buttons: true,
	dangerMode: true,
	})
	.then((willDelete) => {
	if (willDelete) {
	
		$.ajax({
			url: '{% url "deleteAll"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'origin': originID,
				'id': id,
				'option': '10'
			},
			dataType: 'json',
			success: function (data) { 
				if(data.Eliminado=='True'){

					var table = $('#dataTableGetRegisters').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.RG.length; i++){

						table.row.add( [
						data.RG[i].register,
						data.RG[i].observation,
						data.RG[i].value,
						data.RG[i].balance,
						data.RG[i].date,
						"<a data-toggle='tooltip' title='Ver detalles de registro'><button onclick='getDetailRegister("+data.RG[i].id+")' data-toggle='modal' data-target='#myModalDetailRegister' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
						"<a data-toggle='tooltip'  type='button'  title='Eliminar registro'><button onclick=\'deleteRegister("+JSON.stringify(data.RG[i].id)+','+JSON.stringify(data.RG[i].register)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
						"<a data-toggle='tooltip'  id='updateRegistro' title='Actualizar registro'><button onclick=\'getRubroImplicadoRD("+JSON.stringify(data.RG[i].id)+','+JSON.stringify(data.RG[i].register)+")\' data-toggle='modal' data-target='#myModalRubroImplicadoRegister' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
						])
					}
					table.draw( false );
					swal("El registro con número " + numero + " se ha eliminado con éxito."," ","success");
				}else{
					swal("El registro con número " + numero + " contiene obligaciones."," ","error");
				}		  
			}
		});
	}
	});
}
function getRubroImplicadoRD(id,register){
	var totalDetailReg=0;
	var totalDetailRegister=0;
	$.ajax({
			url: '{% url "getRubroImpDetailRegister"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'register':id,
			},
			
			dataType: 'json',
			
			success: function (data) {

				var table = $('#datatableRubroImplicadoRegister').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.DRG.length; i++){

				table.row.add( [
				data.DRG[i].rubro,
				data.DRG[i].description,
				"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10' value="+data.DRG[i].value+"  id=valueDataUpdateDR"+data.DRG[i].id+" class='form-control'>",
				data.DRG[i].budgetEject,
				data.DRG[i].balance,

				"<a data-toggle='tooltip'  id='deleteDetailRegister' title='Eliminar rubro implicado en registro'><button onclick=\'deleteDR("+JSON.stringify(data.DRG[i].registerID)+','+id+','+JSON.stringify(data.DRG[i].rubro)+','+register+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
				"<a data-toggle='tooltip'  id='updateDatailRegister' title='Actualizar rubro implicado en registro'><button onclick=\'updateDetailRegister("+JSON.stringify(data.DRG[i].registerID)+','+id+','+JSON.stringify(data.DRG[i].id)+','+JSON.stringify(data.DRG[i].value)+")\' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
				])
				totalDetailReg = totalDetailReg + data.DRG[i].balance;
				totalDetailRegister = totalDetailRegister + data.DRG[i].value;				
			}
			table.draw( false );

			$("#totalBalanceDR").text("SALDO: "+ totalDetailReg);	
			$("#totalRegisterDR").text("REGISTRO: "+ totalDetailRegister);

		}
	});
}
function deleteDR(id,registerID,rubro,register){
	var totalDetailReg=0;
	var totalDetailRegister=0;
	swal({
	title: "Desea eliminar el rubro " + rubro + "implicado en el registro número " + register + "?",
	text: "Al confirmar esta acción, el rubro implicado en el registro número " + register + " sera eliminado.",
	icon: "warning",
	buttons: true,
	dangerMode: true,
	})
	.then((willDelete) => {
	if (willDelete) {

		$.ajax({
			url: '{% url "deleteAll"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'id': id,
				'option': '16',
				'registerID': registerID,
				'origin': originID,
				'register': register
			},
			dataType: 'json',
			success: function (data) {
				if(data.DRG.length==0){
					var table = $('#dataTableGetRegisters').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.RG.length; i++){

						table.row.add( [
						data.RG[i].register,
						data.RG[i].observation,
						data.RG[i].value,
						data.RG[i].balance,
						data.RG[i].date,
						"<a data-toggle='tooltip' title='Ver detalles de registro'><button onclick='getDetailRegister("+data.RG[i].id+")' data-toggle='modal' data-target='#myModalDetailRegister' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
						"<a data-toggle='tooltip'  type='button'  title='Eliminar registro'><button onclick=\'deleteRegister("+JSON.stringify(data.RG[i].id)+','+JSON.stringify(data.RG[i].register)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
						"<a data-toggle='tooltip'  id='updateRegistro' title='Actualizar registro'><button onclick=\'getRubroImplicadoRD("+JSON.stringify(data.RG[i].id)+','+JSON.stringify(data.RG[i].register)+")\' data-toggle='modal' data-target='#myModalRubroImplicadoRegister' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
						
						])   
					}
					table.draw( false );
					swal("El rubro implicado en el registro número " + register + " y su registro se ha eliminado con éxito."," Continua con tu proceso ","success");
					$('#myModalRubroImplicadoRegister').modal('toggle');

				}else{
					var table = $('#datatableRubroImplicadoRegister').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.DRG.length; i++){

					table.row.add( [
					data.DRG[i].rubro,
					data.DRG[i].description,
					data.DRG[i].value,
					data.DRG[i].budgetEject,
					data.DRG[i].balance,

					"<a data-toggle='tooltip'  id='deleteDetailRegister' title='Eliminar rubro implicado en registro'><button onclick=\'deleteDR("+JSON.stringify(data.DRG[i].registerID)+','+id+','+JSON.stringify(data.DRG[i].rubro)+','+register+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
					"<a data-toggle='tooltip'  id='updateDatailRegister' title='Actualizar rubro implicado en registro'><button onclick=\'updateDetailRegister("+JSON.stringify(data.DRG[i].registerID)+','+id+','+JSON.stringify(data.DRG[i].id)+','+JSON.stringify(data.DRG[i].value)+")\' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
					])
					totalDetailReg = totalDetailReg + data.DRG[i].balance;
					totalDetailRegister = totalDetailRegister + data.DRG[i].value;				
				}
				table.draw( false );

				$("#totalBalanceDR").text("SALDO: "+ totalDetailReg);	
				$("#totalRegisterDR").text("REGISTRO: "+ totalDetailRegister);
				
				swal("El rubro implicado en el registro número " + register + "  se ha eliminado con éxito."," ","success");
				}				
			}
		});
	}
	});
}

function updateDetailRegister(id,register,rubroID,oldValue){

	var totalDetailReg=0;
	var totalDetailRegister=0;
	var oldValue;
	var valueDataUpdateDR =  "#valueDataUpdateDR"+rubroID; //ESTE ES EL VALOR nuevo
	var newValue =  parseInt($(valueDataUpdateDR).val());
	var nameOrigin = $('input[name=origins]:checked', '#addVoucher').val();

	console.log(id)
	console.log(register)
	console.log(oldValue)
	console.log(rubroID)
	console.log(valueDataUpdateDR)
	console.log(newValue)

	alert("por favor funciona jajajajajajaj")
	if(oldValue<newValue){

		var newValueOperated = parseInt(oldValue) - parseInt(newValue) * -1;
		console.log(newValueOperated)
		$.ajax({
			url: '{% url "updateDetailRegister"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'id':id,
				'origin':  originID,
				'register': register,
				'rubroID': rubroID,
				'newValueOperated': newValueOperated,
				'oldValue': oldValue,
				'newValue': newValue,
			},
			
			dataType: 'json',
			
			success: function (data) {
				console.log(data)
				if(data.CREATE == "TRUE"){

					var table = $('#datatableRubroImplicadoRegister').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.DRG.length; i++){

					table.row.add( [
					data.DRG[i].rubro,
					data.DRG[i].description,
					"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10' value="+data.DRG[i].value+"  id=valueDataUpdateDR"+data.DRG[i].id+" class='form-control'>",
					data.DRG[i].budgetEject,
					data.DRG[i].balance,

					"<a data-toggle='tooltip'  id='deleteDetailRegister' title='Eliminar rubro implicado en registro'><button onclick=\'deleteDR("+JSON.stringify(data.DRG[i].registerID)+','+id+','+JSON.stringify(data.DRG[i].rubro)+','+register+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
					"<a data-toggle='tooltip'  id='updateDatailRegister' title='Actualizar rubro implicado en registro'><button onclick=\'updateDetailRegister("+JSON.stringify(data.DRG[i].registerID)+','+id+','+JSON.stringify(data.DRG[i].id)+','+JSON.stringify(data.DRG[i].value)+")\' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
					])
					totalDetailReg = totalDetailReg + data.DRG[i].balance;
					totalDetailRegister = totalDetailRegister + data.DRG[i].value;				
					}
					table.draw( false );

					$("#totalBalanceDR").text("SALDO: "+ totalDetailReg);	
					$("#totalRegisterDR").text("REGISTRO: "+ totalDetailRegister);   

					swal("Actualización exitosa!", "Continua con tu proceso!", "success");
					
					$("#textTableRubrosRegister").text("Rubros de registro de "+nameOrigin);
					$("#divTabRegisterText").text("Lista de registros realizados del presupuesto de "+nameOrigin);
					var tableListMovementRegister = $('#dataTableGetRegisters').DataTable(); 
					var rows = tableListMovementRegister.rows().remove().draw();
					for (var i=0; i<data.TMVRG.length; i++){

						tableListMovementRegister.row.add( [
						data.TMVRG[i].register,
						data.TMVRG[i].observation,
						data.TMVRG[i].value,
						data.TMVRG[i].balance,
						data.TMVRG[i].date,
						"<a data-toggle='tooltip' title='Ver detalles de registro'><button onclick='getDetailRegister("+data.TMVRG[i].id+")' data-toggle='modal' data-target='#myModalDetailRegister' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
						"<a data-toggle='tooltip'  type='button'  title='Eliminar registro'><button onclick=\'deleteRegister("+JSON.stringify(data.TMVRG[i].id)+','+JSON.stringify(data.TMVRG[i].register)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
						"<a data-toggle='tooltip'  id='updateRegistro' title='Actualizar registro'><button onclick=\'getRubroImplicadoRD("+JSON.stringify(data.TMVRG[i].id)+','+JSON.stringify(data.TMVRG[i].register)+")\' data-toggle='modal' data-target='#myModalRubroImplicadoRegister' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
				
						])
					}
					tableListMovementRegister.draw( false );
					
				}else{
					swal("No se puede actualizar el rubro implicado en registro", "Ya que el valor dígitado es mayor al del saldo", "error");
					
				} 	
			}

		});
	}else{
		var newValueOperated = parseInt(oldValue) - parseInt(newValue);
		console.log(newValueOperated)                                                                                     
		$.ajax({
			url: '{% url "updateDetailRegister"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'id':id,
				'origin':  originID,
				'register': register,
				'rubroID': rubroID,
				'newValueOperated': newValueOperated,
				'oldValue': oldValue,
				'newValue': newValue,
			},
			
			dataType: 'json',
			
			success: function (data) {
				console.log(data)

				if(data.CREATE == "TRUE"){

					var table = $('#datatableRubroImplicadoRegister').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.DRG.length; i++){

					table.row.add( [
					data.DRG[i].rubro,
					data.DRG[i].description,
					"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10' value="+data.DRG[i].value+"  id=valueDataUpdateDR"+data.DRG[i].id+" class='form-control'>",
					data.DRG[i].budgetEject,
					data.DRG[i].balance,
					
					"<a data-toggle='tooltip'  id='deleteDetailRegister' title='Eliminar rubro implicado en registro'><button onclick=\'deleteDR("+JSON.stringify(data.DRG[i].registerID)+','+id+','+JSON.stringify(data.DRG[i].rubro)+','+register+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
					"<a data-toggle='tooltip'  id='updateDatailRegister' title='Actualizar rubro implicado en registro'><button onclick=\'updateDetailRegister("+JSON.stringify(data.DRG[i].registerID)+','+id+','+JSON.stringify(data.DRG[i].id)+','+JSON.stringify(data.DRG[i].value)+")\' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
					])
					totalDetailReg = totalDetailReg + data.DRG[i].balance;
					totalDetailRegister = totalDetailRegister + data.DRG[i].value;				
					}
					table.draw( false );

					$("#totalBalanceDR").text("SALDO: "+ totalDetailReg);	
					$("#totalRegisterDR").text("REGISTRO: "+ totalDetailRegister);    

					swal("Actualización exitosa!", "Continua con tu proceso!", "success");

					$("#textTableRubrosRegister").text("Rubros de registro de "+nameOrigin);
					$("#divTabRegisterText").text("Lista de registros realizados del presupuesto de "+nameOrigin); 
					var tableListMovementRegister = $('#dataTableGetRegisters').DataTable(); 
					var rows = tableListMovementRegister.rows().remove().draw();
					for (var i=0; i<data.TMVRG.length; i++){

						tableListMovementRegister.row.add( [
						data.TMVRG[i].register,
						data.TMVRG[i].observation,
						data.TMVRG[i].value,
						data.TMVRG[i].balance,
						data.TMVRG[i].date,
						"<a data-toggle='tooltip' title='Ver detalles de registro'><button onclick='getDetailRegister("+data.TMVRG[i].id+")' data-toggle='modal' data-target='#myModalDetailRegister' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
						"<a data-toggle='tooltip'  type='button'  title='Eliminar registro'><button onclick=\'deleteRegister("+JSON.stringify(data.TMVRG[i].id)+','+JSON.stringify(data.TMVRG[i].register)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
						"<a data-toggle='tooltip'  id='updateRegistro' title='Actualizar registro'><button onclick=\'getRubroImplicadoRD("+JSON.stringify(data.TMVRG[i].id)+','+JSON.stringify(data.TMVRG[i].register)+")\' data-toggle='modal' data-target='#myModalRubroImplicadoRegister' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
				
						])
					}
					tableListMovementRegister.draw( false );
					
				}else{
					swal("No se puede actualizar el rubro implicado en registro", "Ya que el valor dígitado es mayor al del saldo", "error");
					
				} 
		}
	});
	}
}
//-----------parte de obligación-----------
function getDataToObligation(){

	$("#divCreate").css("display", "none");
	$("#divRegister").css("display", "none");
	$("#divObligation").css("display", "block");
	$("#divVoucherPayment").css("display", "none");

	$.ajax({
			url: '{% url "getDataToObligation"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				console.log(data)

				const $selectTH = document.querySelector("#terceroSelectObligation");
				const $select = document.querySelector("#registerObligation");
				for (let i = $select.options.length; i >= 0; i--) {
						$select.remove(i);
				}
				for (let i = $selectTH.options.length; i >= 0; i--) {
						$selectTH.remove(i);
				}  
				$('#terceroSelectObligation').append(`<option  hidden  selected"> Selecciona una opción</option>`);
				$('#registerObligation').append(`<option  hidden  selected"> Selecciona una opción</option>`);	
				for (var i=0; i<data.MV.length; i++){
					$('#registerObligation').append('<option value='+data.MV[i].id+'>'+data.MV[i].register+'</option>')
				}
				for (var i=0; i<data.TH.length; i++){
					$('#terceroSelectObligation').append('<option value='+data.TH[i].id+'>'+data.TH[i].name + " " +data.TH[i].surnames+'</option>')
				}

				var table = $('#dataTableGetObligation').DataTable(); 
				var rows = table.rows().remove().draw();
				for (var i=0; i<data.OB.length; i++){

					table.row.add( [
					data.OB[i].obligation,
					data.OB[i].observation,
					data.OB[i].value,
					data.OB[i].balance,
					data.OB[i].date,
					
					"<a data-toggle='tooltip' title='Ver detalles de obligación'><button onclick='getDetailObligation("+data.OB[i].id+")' data-toggle='modal' data-target='#myModalDetailObligation' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
					"<a data-toggle='tooltip' type='button' title='Eliminar obligación'><button onclick=\'deleteObligation("+JSON.stringify(data.OB[i].id)+','+JSON.stringify(data.OB[i].obligation)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
					"<a data-toggle='tooltip'  id='updateObligation' title='Actualizar obligación'><button onclick=\'getRubroImplicadoObligation("+JSON.stringify(data.OB[i].id)+','+JSON.stringify(data.OB[i].obligation)+")\' data-toggle='modal' data-target='#myModalRubroImplicadoObligation' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
					])
				}
				table.draw( false );
			}
	});
	$.ajax({
			url: '{% url "getObligationSerial"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				$("#numberObligation").val(data.OB); 

			}
	});
}
function getDetailObligation(id){
	var totalDetailOblig=0;
	var totalDetailObligation=0;
	$.ajax({
			url: '{% url "getDetailObligation"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'obligation':id,
			},
			dataType: 'json',
			success: function (data) {
				
				var table = $('#datatableDetailObligation').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.OB.length; i++){

				table.row.add( [

				data.OB[i].rubro,
				data.OB[i].description,
				data.OB[i].value,
				data.OB[i].budgetEject,
				data.OB[i].balance
				
				])
				totalDetailOblig = totalDetailOblig + data.OB[i].balance;
				totalDetailObligation = totalDetailObligation + data.OB[i].value;				
			}
			table.draw( false );

			$("#totalDetailObligation").text("SALDO: "+ totalDetailOblig);	
			$("#totalBalanceDetailObligation").text("OBLIGACIÓN: "+ totalDetailObligation);

		}
	});
}  
function deleteObligation(id, numero){
  
	swal({
	title: "Desea eliminar la obligación con número " + numero + "?",
	text: "Al confirmar esta acción, la obligación con número " + numero + " sera eliminado.",
	icon: "warning",
	buttons: true,
	dangerMode: true,
	})
	.then((willDelete) => {
	if (willDelete) {
	
		$.ajax({
			url: '{% url "deleteAll"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'origin': originID,
				'id': id,
				'option': '11'
			},
			dataType: 'json',
			success: function (data) { 
				if(data.Eliminado=='True'){

					var table = $('#dataTableGetObligation').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.OB.length; i++){

						table.row.add( [
						data.OB[i].obligation,
						data.OB[i].observation,
						data.OB[i].value,
						data.OB[i].balance,
						data.OB[i].date,
						"<a data-toggle='tooltip' title='Ver detalles de obligación'><button onclick='getDetailObligation("+data.OB[i].id+")' data-toggle='modal' data-target='#myModalDetailObligation' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
						"<a data-toggle='tooltip' type='button' title='Eliminar obligación'><button onclick=\'deleteObligation("+JSON.stringify(data.OB[i].id)+','+JSON.stringify(data.OB[i].obligation)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
						"<a data-toggle='tooltip'  id='updateObligation' title='Actualizar obligación'><button onclick=\'getRubroImplicadoObligation("+JSON.stringify(data.OB[i].id)+','+JSON.stringify(data.OB[i].obligation)+")\' data-toggle='modal' data-target='#myModalRubroImplicadoObligation' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
						])
					}
					table.draw( false );
					swal("La obligación con número " + numero + " se ha eliminado con éxito."," ","success");
				}else{
					swal("La obligación con número " + numero + " contiene comprobante de pagos."," ","error");
				}		  
			}
		});
	}
	});
}

function DeleteRIDO(id,obligationID,rubro,obligation){
	var totalDetailOblig=0;
	var totalDetailObligation=0;
	console.log("entre")
	swal({
	title: "Desea eliminar el rubro " + rubro + "implicado en la obligación número " + obligation + "?",
	text: "Al confirmar esta acción, el rubro implicado en la obligación con número " + obligation + " sera eliminado.",
	icon: "warning",
	buttons: true,
	dangerMode: true,
	})
	.then((willDelete) => {
	if (willDelete) {
	
		$.ajax({
			url: '{% url "deleteAll"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'id': id,
				'option': '17',
				'obligationID': obligationID,
				'origin': originID,
				'obligation': obligation
			},
			dataType: 'json',
			success: function (data) { 

				if(data.OB.length==0){

					var table = $('#dataTableGetObligation').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.MV.length; i++){

						table.row.add( [
						data.MV[i].obligation,
						data.MV[i].observation,
						data.MV[i].value,
						data.MV[i].balance,
						data.MV[i].date,
						
						"<a data-toggle='tooltip' title='Ver detalles de obligación'><button onclick='getDetailObligation("+data.MV[i].id+")' data-toggle='modal' data-target='#myModalDetailObligation' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
						"<a data-toggle='tooltip' type='button' title='Eliminar obligación'><button onclick=\'deleteObligation("+JSON.stringify(data.MV[i].id)+','+JSON.stringify(data.MV[i].obligation)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
						"<a data-toggle='tooltip'  id='updateObligation' title='Actualizar obligación'><button onclick=\'getRubroImplicadoObligation("+JSON.stringify(data.MV[i].id)+','+JSON.stringify(data.MV[i].obligation)+")\' data-toggle='modal' data-target='#myModalRubroImplicadoObligation' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
						])
					}
					table.draw( false );
					swal("El rubro implicado en la obligacion número " + register + " y su obligacion se ha eliminado con éxito."," Continua con tu proceso ","success");

	
				}else{
					
					var table = $('#datatableRubroImplicadoObligation').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.OB.length; i++){

						table.row.add( [
						data.OB[i].rubro,
						data.OB[i].description,
						"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10' value="+data.OB[i].value+"  id=valueDataUpdateOblig"+data.OB[i].id+" class='form-control'>",
						data.OB[i].budgetEject,
						data.OB[i].balance,

						"<a data-toggle='tooltip'  id='deleteDetailObligation' title='Eliminar rubro implicado en obligación'><button onclick=\'DeleteRIDO("+JSON.stringify(data.OB[i].idObligation)+','+id+','+JSON.stringify(data.OB[i].rubro)+','+obligation+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
						"<a data-toggle='tooltip'  id='updateDatailObligation' title='Actualizar rubro implicado en obligación'><button onclick=\'updateDetailObligation("+JSON.stringify(data.OB[i].idObligation)+','+id+','+JSON.stringify(data.OB[i].id)+','+JSON.stringify(data.OB[i].value)+")\' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
						])
						totalDetailOblig = totalDetailOblig + data.OB[i].balance;
						totalDetailObligation = totalDetailObligation + data.OB[i].value;				
					}
					table.draw( false );
					 
					$("#totalBalanceObligation").text("SALDO: "+ totalDetailOblig);	
					$("#totalObligation").text("OBLIGACIÓN: "+ totalDetailObligation);
					swal("El rubro implicado en la obligacion número " + register + "  se ha eliminado con éxito."," ","success");

				}

		  
			}
		});
	}
	});
}
function getRubroImplicadoObligation(id,obligation){
	var totalDetailOblig=0;
	var totalDetailObligation=0;
	$.ajax({
			url: '{% url "getRubroImpDetailObligation"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'obligation':id,
			},
			
			dataType: 'json',
			
			success: function (data) {

				var table = $('#datatableRubroImplicadoObligation').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.OB.length; i++){

				table.row.add( [
				data.OB[i].rubro,
				data.OB[i].description,
				"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10' value="+data.OB[i].value+"  id=valueDataUpdateOblig"+data.OB[i].id+" class='form-control'>",
				data.OB[i].budgetEject,
				data.OB[i].balance,

				"<a data-toggle='tooltip'  id='deleteDetailObligation' title='Eliminar rubro implicado en obligación'><button onclick=\'DeleteRIDO("+JSON.stringify(data.OB[i].idObligation)+','+id+','+JSON.stringify(data.OB[i].rubro)+','+obligation+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
				"<a data-toggle='tooltip'  id='updateDatailObligation' title='Actualizar rubro implicado en obligación'><button onclick=\'updateDetailObligation("+JSON.stringify(data.OB[i].idObligation)+','+id+','+JSON.stringify(data.OB[i].id)+','+JSON.stringify(data.OB[i].value)+")\' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
				])
				totalDetailOblig = totalDetailOblig + data.OB[i].balance;
				totalDetailObligation = totalDetailObligation + data.OB[i].value;				
			}
			table.draw( false );

			$("#totalBalanceObligation").text("SALDO: "+ totalDetailOblig);	
			$("#totalObligation").text("OBLIGACIÓN: "+ totalDetailObligation);

		}
	});
} 
function updateDetailObligation(id,obligation,rubroID,oldValue){

	var totalDetailOblig=0;
	var totalDetailObligation=0;
	var oldValue;
	var valueDataUpdateOblig =  "#valueDataUpdateOblig"+rubroID; //ESTE ES EL VALOR nuevo
	var newValue =  parseInt($(valueDataUpdateOblig).val());
	var nameOrigin = $('input[name=origins]:checked', '#addVoucher').val();

	console.log(id)
	console.log(obligation)
	console.log(oldValue)
	console.log(rubroID)
	console.log(valueDataUpdateOblig)
	console.log(newValue)

	alert("por favor funciona jajajajajajaj")
	if(oldValue<newValue){

		var newValueOperated = parseInt(oldValue) - parseInt(newValue) * -1;
		console.log(newValueOperated)
		$.ajax({
			url: '{% url "updateDetailObligation"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'id':id,
				'origin':  originID,
				'obligation': obligation,
				'rubroID': rubroID,
				'newValueOperated': newValueOperated,
				'oldValue': oldValue,
				'newValue': newValue,
			},
			
			dataType: 'json',
			
			success: function (data) {
				console.log(data)
				if(data.CREATE == "TRUE"){

					var table = $('#datatableRubroImplicadoDisponibility').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.OB.length; i++){

					table.row.add( [
					data.OB[i].rubro,
					data.OB[i].description,
					"<input type='text'   onkeypress='return validaNumericos(event)'/  size='10' value="+data.OB[i].value+"  id=valueDataUpdateOblig"+data.OB[i].id+" class='form-control'>",
					data.OB[i].budgetEject,
					data.OB[i].balance,

					"<a data-toggle='tooltip'  id='deleteDetailObligation' title='Eliminar rubro implicado en obligación'><button onclick=\'DeleteRIDO("+JSON.stringify(data.OB[i].idObligation)+','+id+','+JSON.stringify(data.OB[i].rubro)+','+obligation+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
					"<a data-toggle='tooltip'  id='updateDatailObligation' title='Actualizar rubro implicado en obligación'><button onclick=\'updateDetailObligation("+JSON.stringify(data.OB[i].idObligation)+','+id+','+JSON.stringify(data.OB[i].id)+','+JSON.stringify(data.OB[i].value)+")\' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
					])
					totalDetailOblig = totalDetailOblig + data.OB[i].balance;
					totalDetailObligation = totalDetailObligation + data.OB[i].value;			
					}
					table.draw( false );

					$("#totalBalanceObligation").text("SALDO: "+ totalDetailOblig);	
					$("#totalObligation").text("OBLIGACIÓN: "+ totalDetailObligation);    

					swal("Actualización exitosa!", "Continua con tu proceso!", "success");

					$("#textTableRubrosObligText").text("Rubros de obligación de "+nameOrigin);
					$("#divTabObligationText").text("Lista de obligaciones realizados del presupuesto de "+nameOrigin); 
					var tableListMovementOblig = $('#dataTableGetObligation').DataTable(); 
					var rows = tableListMovementOblig.rows().remove().draw();
					for (var i=0; i<data.TMVOB.length; i++){

						tableListMovementOblig.row.add( [
						data.TMVOB[i].obligation,
						data.TMVOB[i].observation,
						data.TMVOB[i].value,
						data.TMVOB[i].balance,
						data.TMVOB[i].date,
						"<a data-toggle='tooltip' title='Ver detalles de obligación'><button onclick='getDetailObligation("+data.TMVOB[i].id+")' data-toggle='modal' data-target='#myModalDetailObligation' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
						"<a data-toggle='tooltip' type='button' title='Eliminar obligación'><button onclick=\'deleteObligation("+JSON.stringify(data.TMVOB[i].id)+','+JSON.stringify(data.TMVOB[i].obligation)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
						"<a data-toggle='tooltip'  id='updateObligation' title='Actualizar obligación'><button onclick=\'getRubroImplicadoObligation("+JSON.stringify(data.TMVOB[i].id)+','+JSON.stringify(data.TMVOB[i].obligation)+")\' data-toggle='modal' data-target='#myModalRubroImplicadoObligation' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
				
						])
					}
					tableListMovementOblig.draw( false );
					
				}else{
					swal("No se puede actualizar el rubro implicado en obligación", "Ya que el valor dígitado es mayor al del saldo", "error");
					
				} 	
			}
		});
	}else{
		var newValueOperated = parseInt(oldValue) - parseInt(newValue);
		console.log(newValueOperated)                                                                                     
		$.ajax({
			url: '{% url "updateDetailObligation"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'id':id,
				'origin':  originID,
				'obligation': obligation,
				'rubroID': rubroID,
				'newValueOperated': newValueOperated,
				'oldValue': oldValue,
				'newValue': newValue,
			},
			
			dataType: 'json',
			
			success: function (data) {
				console.log(data)

				if(data.CREATE == "TRUE"){

					var table = $('#datatableRubroImplicadoDisponibility').DataTable(); 
					var rows = table.rows().remove().draw();
					for (var i=0; i<data.OB.length; i++){

					table.row.add( [
					data.OB[i].rubro,
					data.OB[i].description,
					"<input type='text'   onkeypress='return validaNumericos(event)'/  size='10' value="+data.OB[i].value+"  id=valueDataUpdateOblig"+data.OB[i].id+" class='form-control'>",
					data.OB[i].budgetEject,
					data.OB[i].balance,
					
					"<a data-toggle='tooltip'  id='deleteDetailObligation' title='Eliminar rubro implicado en obligación'><button onclick=\'DeleteRIDO("+JSON.stringify(data.OB[i].idObligation)+','+id+','+JSON.stringify(data.OB[i].rubro)+','+obligation+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
					"<a data-toggle='tooltip'  id='updateDatailObligation' title='Actualizar rubro implicado en obligación'><button onclick=\'updateDetailObligation("+JSON.stringify(data.OB[i].idObligation)+','+id+','+JSON.stringify(data.OB[i].id)+','+JSON.stringify(data.OB[i].value)+")\' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
					])
					totalDetailOblig = totalDetailOblig + data.OB[i].balance;
					totalDetailObligation = totalDetailObligation + data.OB[i].value;				
					}
					table.draw( false );

					$("#totalBalanceObligation").text("SALDO: "+ totalDetailOblig);	
					$("#totalObligation").text("OBLIGACIÓN: "+ totalDetailObligation);    

					swal("Actualización exitosa!", "Continua con tu proceso!", "success");

					$("#textTableRubrosObligText").text("Rubros de obligación de "+nameOrigin);
					$("#divTabObligationText").text("Lista de obligaciones realizados del presupuesto de "+nameOrigin); 
					var tableListMovementOblig = $('#dataTableGetObligation').DataTable(); 
					var rows = tableListMovementOblig.rows().remove().draw();
					for (var i=0; i<data.TMVOB.length; i++){

						tableListMovementOblig.row.add( [
						data.TMVOB[i].obligation,
						data.TMVOB[i].observation,
						data.TMVOB[i].value,
						data.TMVOB[i].balance,
						data.TMVOB[i].date,
						"<a data-toggle='tooltip' title='Ver detalles de obligación'><button onclick='getDetailObligation("+data.TMVOB[i].id+")' data-toggle='modal' data-target='#myModalDetailObligation' class='btn btn-primary btn-sm'><i class='fa fa-info-circle' aria-hidden='true'></i></button></a>"+			
						"<a data-toggle='tooltip' type='button' title='Eliminar obligación'><button onclick=\'deleteObligation("+JSON.stringify(data.TMVOB[i].id)+','+JSON.stringify(data.TMVOB[i].obligation)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"+
						"<a data-toggle='tooltip'  id='updateObligation' title='Actualizar obligación'><button onclick=\'getRubroImplicadoObligation("+JSON.stringify(data.TMVOB[i].id)+','+JSON.stringify(data.TMVOB[i].obligation)+")\' data-toggle='modal' data-target='#myModalRubroImplicadoObligation' class='btn btn-primary btn-sm'><i class='fa fa-pencil'></i></button></a>"
				
						])
					}
					tableListMovementOblig.draw( false );
					
				}else{
					swal("No se puede actualizar el rubro implicado en obligación", "Ya que el valor dígitado es mayor al del saldo", "error");
					
				} 
			}
		});
	}
}

function cancels(option){
	if(option==1){
		$('#myModalCreateThird').modal('toggle');
		$('#myModalThirds').modal('toggle');
	}
	if(option==2){
		
		swal({
			title: "Desea cancelar por completo la disponibilidad?",
			text: "No se guardara ningun valor agregado.",
			icon: "warning",
			buttons: true,
			dangerMode: true,
			})
			.then((willDelete) => {
			if (willDelete) {
				$("#divCreate").css("display", "none");
				$("#divAgreement").css("display", "none");
				var tableRubros = $('#dataTableTest').DataTable(); 
				var rowsRubros = tableRubros.rows().remove().draw();
				$("#rubroContraOperations").css('display', 'none');		
				$('textarea[name="observation"]').val("");
				rubrosToOperation.length = 0;
				totalOperateArray.length =0;
				addDisponibility.length =0;
				totalDisponibility = 0;
				totalOperate = 0;
				$("#totalBalance").text("SALDO: "+ totalOperate);														
				$("#totalDisponibility").text("DISPONIBILIDAD: "+ totalDisponibility);	

			}
		});
	}if(option==3){
		swal({
			title: "Desea cancelar por completo el registro?",
			text: "No se guardara ningun valor agregado.",
			icon: "warning",
			buttons: true,
			dangerMode: true,
			})
			.then((willDelete) => {
			if (willDelete) {
				$("#divRegister").css("display", "none");
				$('textarea[name="observationRegister"]').val("");
				addRegister.length=0;
				totalRegister=0;
				totalOperateArrayRegister.length=0;
				totalOperateRegister=0;
				var table = $('#dataTableRegister').DataTable(); 
 				var rows = table.rows().remove().draw();
				$("#totalRegister").text("SALDO: "+ totalOperateRegister);														
				$("#totalRegisterBalance").text("REGISTRO: "+ totalRegister);
			}
		});
		
	}
	if(option==4){
		swal({
			title: "Desea cancelar por completo la obligación?",
			text: "No se guardara ningun valor agregado.",
			icon: "warning",
			buttons: true,
			dangerMode: true,
			})
			.then((willDelete) => {
			if (willDelete) {
				$("#divObligation").css("display", "none");
				$('textarea[name="observationObligation"]').val("");
				addObligation.length=0;
				totalObligation=0;
				totalOperateArrayObligation.length=0;
				totalOperateObligation=0;
				var table = $('#dataTableObligation').DataTable(); 
				var rows = table.rows().remove().draw();
				$("#totalObligation").text("SALDO: "+ totalOperateObligation);														
				$("#totalObligationBalance").text("OBLIGACIÓN: "+ totalObligation);	
			}
		});

	}
}

function getDisponibilitysRg(){
	$.ajax({
			url: '{% url "getDisponibilityRegister"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {

				var table = $('#dataTableSelectDisponibility').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.DP.length; i++){

				table.row.add( [
				data.DP[i].disponibility,
				data.DP[i].value,
				data.DP[i].balance,
				data.DP[i].date,
				data.DP[i].observation,
				"<a data-toggle='tooltip' title='Seleccionar disponibilidad'><button  onclick=\'selectDisponibilty("+JSON.stringify(data.DP[i].id)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"														
				])
				
			}
			table.draw( false );

			}
		});
}


function selectDisponibilty(id){

	$('#myModalDisponibilityOrigin').modal('toggle');
	$('#disponibilitySelectRegister> option[value='+id+']').attr('selected', 'selected');
	disponibilitySec = id;
	$.ajax({
			url: '{% url "fillDisponibility"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'disponibility':id,
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				$("#observationRegister").val(data.OBSERVATION); 
				$("#dateRegister").val(data.DATE); 
				dateValidation =  data.DATE;
				var table = $('#dataTableRegister').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RUBRO.length; i++){

				table.row.add( [
				data.RUBRO[i].rubro,
				data.RUBRO[i].description,
				data.RUBRO[i].value,
				"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'   id=register"+data.RUBRO[i].id+" class='form-control' name='inputRegister'>",
				"<label type='number' id=registerBalance"+data.RUBRO[i].id+">"+ JSON.stringify(data.RUBRO[i].valueP)+"</label>",
				"<a data-toggle='tooltip' title='Validar operación'><button type='button' onclick=\'operateBalanceRegister("+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].value)+','+JSON.stringify(data.RUBRO[i].idDispo)+','+JSON.stringify(data.RUBRO[i].valueP)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"			
				])
			}
			table.draw( false );
			}
	});

}
function selectDisponibiltyToRegister(id){

	$('#disponibilitySelectRegister> option[value='+id+']').attr('selected', 'selected');
	disponibilitySec = id;
	$.ajax({
			url: '{% url "fillDisponibility"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'disponibility':id,
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				$("#observationRegister").val(data.OBSERVATION);
				$("#dateRegister").val(data.DATE); 
				dateValidation =  data.DATE; 
				var table = $('#dataTableRegister').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RUBRO.length; i++){

				table.row.add( [
				data.RUBRO[i].rubro,
				data.RUBRO[i].description,
				data.RUBRO[i].value,
				"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'   id=register"+data.RUBRO[i].id+" class='form-control' name='inputRegister'>",
				"<label type='number' id=registerBalance"+data.RUBRO[i].id+">"+ JSON.stringify(data.RUBRO[i].valueP)+"</label>",
				"<a data-toggle='tooltip' title='Validar operación'><button type='button' onclick=\'operateBalanceRegister("+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].value)+','+JSON.stringify(data.RUBRO[i].idDispo)+','+JSON.stringify(data.RUBRO[i].valueP)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"			
				])
			}
			table.draw( false );
			}
	});

}
function getThirdsRg(){
	$.ajax({
			url: '{% url "getThirds"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {

				var table = $('#dataTableThirds').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.TH.length; i++){

				table.row.add( [
				data.TH[i].name,
				data.TH[i].surnames,
				data.TH[i].typeIdentification,
				data.TH[i].identification,
				data.TH[i].phone,
				"<a data-toggle='tooltip' title='Seleccionar tercero'><button  id="+JSON.stringify(data.TH[i].id)+" onclick=\'selectThirds("+JSON.stringify(data.TH[i].id)+','+JSON.stringify(data.TH[i].name)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"														
				])
				
			}
			table.draw( false );

			}
		});
}

function selectThirds(id,name){
    $('#terceroSelectRegister> option[value='+id+']').attr('selected', 'selected');
	$('#terceroSelectObligation> option[value='+id+']').attr('selected', 'selected');
	$('#myModalThirds').modal('toggle');
}

function submitThird() {
	var typeIdentification = $("#id_typeIdentification option:selected").text();
	var identification = $('input[name="identification"]').val();
	var name = $('input[name="name"]').val();
	var surnames = $('input[name="surnames"]').val();
	var reason = $('input[name="reason"]').val();
	var phone = $('input[name="phone"]').val();
	var city = $('input[name="city"]').val();   

	if (typeIdentification, identification, name, surnames, reason, phone, city) {
		// Create Ajax Call
		$.ajax({
			url: '{% url "createThird"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines': localStorage.getItem('idBussines'),
				'typeIdentification': typeIdentification,
				'identification': identification,
				'name': name,
				'surnames': surnames,    
				'reason': reason,
				'phone': phone,
				'city': city, 
			},
			dataType: 'json',
			success: function (data) {
				console.log(data);
				if (data.CREATE=="TRUE"){
					swal("Creado exitoso del nuevo tercero!", "Continua con tu proceso!", "success");
					$('#myModalCreateThird').modal('toggle');
					$('#myModalThirds').modal('toggle');
					$.ajax({
						url: '{% url "getThirds"  0 %}'.replace('0', localStorage.getItem('userID')),
						data: {
							'bussines':localStorage.getItem('idBussines'),
							'origin': originID
						},
						dataType: 'json',
						success: function (data) {

							var table = $('#dataTableThirds').DataTable(); 
							var rows = table.rows().remove().draw();
							for (var i=0; i<data.TH.length; i++){

							table.row.add( [
							data.TH[i].name,
							data.TH[i].surnames,
							data.TH[i].typeIdentification,
							data.TH[i].identification,
							data.TH[i].phone,
							"<a data-toggle='tooltip' title='Seleccionar tercero'><button  id="+JSON.stringify(data.TH[i].id)+" onclick=\'selectThirds("+JSON.stringify(data.TH[i].id)+','+JSON.stringify(data.TH[i].name)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"														
							])
							
						}
						table.draw( false );

						}
					});
				}else{
					swal("No se puede crear un tercero con el mismo nombre para esta empresa", "Verifique sus datos!", "error");
				}
				
			}
		});
	} else {
		alert("Por favor llene todos los campos");
	}
	$('form#addThird').trigger("reset");
	return false;
}

function viewFormThirds(){
	$('#myModalThirds').modal('toggle');
}

$(document).on('change', '#disponibilitySelectRegister', function(event) {
	$.ajax({
			url: '{% url "fillDisponibility"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'disponibility':$( "#disponibilitySelectRegister" ).val(),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				disponibilitySec = $( "#disponibilitySelectRegister" ).val();

				$("#observationRegister").val(data.OBSERVATION);
				$("#dateRegister").val(data.DATE); 
				dateValidation =  data.DATE;
				var table = $('#dataTableRegister').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RUBRO.length; i++){

				table.row.add( [
				data.RUBRO[i].rubro,
				data.RUBRO[i].description,
				data.RUBRO[i].value,
				"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'   id=register"+data.RUBRO[i].id+" class='form-control' name='inputRegister'>",
				"<label type='number' id=registerBalance"+data.RUBRO[i].id+">"+ JSON.stringify(data.RUBRO[i].valueP)+"</label>",
				"<a data-toggle='tooltip' title='Validar operación'><button type='button' onclick=\'operateBalanceRegister("+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].value)+','+JSON.stringify(data.RUBRO[i].idDispo)+','+JSON.stringify(data.RUBRO[i].valueP)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"			
				])
			}
			table.draw( false );			
			}
	});
});

$("#dateRegister").change(function(){
    var valor = $(this).val();
    if(valor!=""){
		if(dateValidation >= valor){
			swal("Fecha minima posible", dateValidation, "warning");
			$("#dateRegister").val(dateValidation);
		}		
    }
})
$("#dateObligation").change(function(){
	console.log(dateValidationR)
    var valor = $(this).val();
    if(valor!=""){
		if(dateValidationR >= valor){
			swal("Fecha minima posible", dateValidationR, "warning");
			$("#dateObligation").val(dateValidationR);
		}		
    }
})
$(document).on('change', '#registerObligation', function(event) {
	$.ajax({
			url: '{% url "fillRegister"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'register':$( "#registerObligation" ).val(),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				console.log(data) 
				$("#observationObligation").val(data.OBSERVATION); 
				dateValidationR =  data.DATE;
				$("#dateObligation").val(data.DATE);
				var table = $('#dataTableObligation').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RUBRO.length; i++){

				table.row.add( [
				data.RUBRO[i].rubro,
				data.RUBRO[i].register,
				data.RUBRO[i].value,
				"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'   id=obligation"+data.RUBRO[i].id+" class='form-control' name='inputObligation'>",
				"<label type='number' id=registerObligation"+data.RUBRO[i].id+">"+ JSON.stringify(data.RUBRO[i].valueP)+"</label>",
				"<a data-toggle='tooltip' title='Validar operación'><button type='button' onclick=\'operateBalanceObligation("+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].value)+','+JSON.stringify(data.RUBRO[i].idRegister)+','+JSON.stringify(data.RUBRO[i].valueP)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"			
				])
			}
			table.draw( false );
			
			}
	});
});

function operateBalanceRegister(id,rubro,value,idDispo,valueP){

	var createId =  "#register"+id;
	var result= "#registerBalance"+id
	var operate=0;
	var valueRegister = parseInt(value);
	operate = parseInt(valueP) - parseInt($(createId).val());
	const found = addRegister.findIndex(element => element['id'] == id);
	if(parseInt($(createId).val())==0){
		swal("No se puede generar una operación de valor 0", " " , "error");
	}else{
		if(found<0){
			if(operate<0){
					swal("El valor de "+ parseInt($(createId).val())+" es mayor a el valor de  "+ value, " No se puede realizar el registro", "error");
				}else{
					$(result).text(operate);
					addRegister.push({
						"idDispo":idDispo,
						"id": id,
						"rubro": rubro,
						"value":parseInt($(createId).val()),
						"balance":operate
					})
					totalOperateArrayRegister.push({
						"id": id,
						"subtotal": operate,
						"register":  parseInt($(createId).val())
					})
					totalOperateRegister = totalOperateRegister + operate;	
					totalRegister = totalRegister + parseInt($(createId).val());
					$("#totalRegister").text("SALDO: "+ totalOperateRegister);														
					$("#totalRegisterBalance").text("REGISTRO: "+ totalRegister);														

				}
				console.log(addRegister)
				console.log(totalOperateArrayRegister)
			}else{

				if(operate<0){
					swal("El valor de "+ parseInt($(createId).val())+" es mayor a el valor de  "+ value, " No se puede realizar el registro", "error");
				}else{
					$(result).text(operate);
					addRegister[found] ={
						"idDispo":idDispo,
						"id": id,
						"rubro": rubro,
						"value":parseInt($(createId).val()),
						"balance":operate
					}
					totalOperateRegister = totalOperateRegister - totalOperateArrayRegister[found]['subtotal'];	
					totalRegister = totalRegister - totalOperateArrayRegister[found]['register'];
					totalOperateArrayRegister[found] = {
						"id": id,
						"subtotal": operate,
						"register":  parseInt($(createId).val())
					}
					totalOperateRegister = totalOperateRegister + totalOperateArrayRegister[found]['subtotal'];	
					totalRegister = totalRegister + totalOperateArrayRegister[found]['register'];
					$("#totalRegister").text("SALDO: "+ totalOperateRegister);														
					$("#totalRegisterBalance").text("REGISTRO: "+ totalRegister);														

				}
				console.log(addRegister)
				console.log(totalOperateRegister)
			}
	}	
	
}

function createRegister(option){
	if(option==1){
		if(totalRegister==0){
		swal("No puede guardar el registro sin valores", "Por favor ingrese el registro", "error");
	}else{
		swal({
        title: "Desea terminar el registro ?",
        text: "Al confirmar esta acción,el registro sera guardado",
        icon: "warning",
        buttons: true,
        dangerMode: true,
        }).then((willDelete) => {
        if (willDelete) {

			var registerCode = $('input[name="registerNumber"]').val();
			var observation = $('textarea[name="observationRegister"]').val();
			var date = $('input[name="dateRegister"]').val();
			if (registerCode,observation,date) {
				// Create Ajax Call
				$.ajax({
					url: '{% url "createRegister"  0 %}'.replace('0', localStorage.getItem('userID')),
					data: {
						'bussines':localStorage.getItem('idBussines'), 
						'registerCode': registerCode,
						'origin': originID,
						'date': date,
						'observation': observation,
						'value':totalRegister,
						'balance': totalOperateRegister,
						'registers': JSON.stringify(addRegister),
						'disponibility': disponibilitySec
					},
					dataType: 'json',
					success: function (data) {
						$("#divRegister").css("display", "none");
						swal("Creado exitoso del registro!", "Continua con tu proceso!", "success");
						$('textarea[name="observationRegister"]').val("");
						addRegister.length=0;
						totalRegister=0;
						totalOperateArrayRegister.length=0;
						totalOperateRegister=0;
						var table = $('#dataTableRegister').DataTable(); 
 						var rows = table.rows().remove().draw();
						$("#totalRegister").text("SALDO: "+ totalOperateRegister);														
						$("#totalRegisterBalance").text("REGISTRO: "+ totalRegister);
						$("#observationRegister").val("");
		
					}
				});
			} else {
				alert("Por favor llene todos los campos");
			}
			return false;
        }
        });
	}
		
	}else{
		if(totalRegister==0){
		swal("No puede guardar el registro sin valores", "Por favor ingrese el registro", "error");
	}else{

		
		swal({
			title: "Desea terminar el registro ?",
			text: "Al confirmar esta acción, l el registro sera guardado",
			icon: "warning",
			buttons: true,
			dangerMode: true,
			}).then((willDelete) => {
			if (willDelete) {
				var registerCode = $('input[name="registerNumber"]').val();
				var observation = $('textarea[name="observationRegister"]').val();
				var date = $('input[name="dateRegister"]').val();
				var third = $("#terceroSelectRegister option:selected").text();
				if (registerCode,observation,date) {
					// Create Ajax Call
					$.ajax({
						url: '{% url "createRegister"  0 %}'.replace('0', localStorage.getItem('userID')),
						data: {
							'bussines':localStorage.getItem('idBussines'), 
							'registerCode': registerCode,
							'origin': originID,
							'date': date,
							'observation': observation,
							'value':totalRegister,
							'balance': totalOperateRegister,
							'registers': JSON.stringify(addRegister),
							'disponibility': disponibilitySec
						},
						dataType: 'json',
						success: function (data) {
							$("#divRegister").css("display", "none");
							swal("Creado exitoso del registro!", "Continua con tu proceso!", "success");
							$('textarea[name="observationRegister"]').val("");
							addRegister.length=0;
							totalRegister=0;
							totalOperateArrayRegister.length=0;
							totalOperateRegister=0;
							$('#registerObligation').prop('disabled', 'disabled');
							$('#terceroSelectObligation').prop('disabled', 'disabled');
							$("#buttonRegisterSelectObligation").css("display", "none");     
							$("#buttonThirdSelectObligation").css("display", "none");
							$("#labelRegisterSelectObligation").text("Registro: "+ data.RG);	
							var table = $('#dataTableRegister').DataTable(); 
							var rows = table.rows().remove().draw();
							$("#totalRegister").text("SALDO: "+ totalOperateRegister);														
							$("#totalRegisterBalance").text("REGISTRO: "+ totalRegister);
							$("#ThirdsToObligation").text("Terceros: "+ third);															
							$("#observationObligation").val(observation);
							$("#dateObligation").val(date); 						
							dateValidationR =  date;
							selectRegisterToObligation(JSON.stringify(data.ID));
							getDataToObligation();

						}
					});
				} else {
					alert("Por favor llene todos los campos");
				}
				return false;
			}
			});		
		}
	}	
}


function getRegistersOB(){
	$.ajax({
			url: '{% url "getRegistersOB"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {

				var table = $('#dataTableSelecRegister').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RG.length; i++){

					table.row.add( [
					data.RG[i].register,
					data.RG[i].value,
					data.RG[i].balance,
					data.RG[i].date,
					data.RG[i].observation,
					"<a data-toggle='tooltip' title='Seleccionar registro'><button  onclick=\'selectRegister("+JSON.stringify(data.RG[i].id)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"														
					])
				
			}
			table.draw( false );

			}
		});
}
function getObligationVoucher(){
	$.ajax({
			url: '{% url "getObligationsVC"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {

				var table = $('#dataTableSelectObligation').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.OB.length; i++){

				table.row.add( [
				data.OB[i].obligation,
				data.OB[i].value,
				data.OB[i].balance,
				data.OB[i].date,
				data.OB[i].observation,
				"<a data-toggle='tooltip' title='Seleccionar registro'><button  onclick=\'selectObligation("+JSON.stringify(data.OB[i].id)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"														
				])
				
			}
			table.draw( false );

			}
		});
}
function selectRegister(id){
	$('#myModalRegister').modal('toggle');
	$('#registerObligation> option[value='+id+']').attr('selected', 'selected');
	$.ajax({
			url: '{% url "fillRegister"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'register':id,
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				$("#observationObligation").val(data.OBSERVATION); 
				$("#dateObligation").val(data.DATE); 
				dateValidationR = data.DATE; 
				var table = $('#dataTableObligation').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RUBRO.length; i++){

				table.row.add( [
				data.RUBRO[i].rubro,
				data.RUBRO[i].register,
				data.RUBRO[i].value,
				"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'   id=obligation"+data.RUBRO[i].id+" class='form-control' name='inputObligation'>",
				"<label type='number' id=registerObligation"+data.RUBRO[i].id+">"+ JSON.stringify(data.RUBRO[i].valueP)+"</label>",
				"<a data-toggle='tooltip' title='Validar operación'><button type='button' onclick=\'operateBalanceObligation("+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].value)+','+JSON.stringify(data.RUBRO[i].idRegister)+','+JSON.stringify(data.RUBRO[i].valueP)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"			
				])
			}
			table.draw( false );
			}
	});

}
function selectRegisterToObligation(id){
	$('#registerObligation> option[value='+id+']').attr('selected', 'selected');
	registerSec = id;
	$.ajax({
			url: '{% url "fillRegister"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'register':id,
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				$("#observationObligation").val(data.OBSERVATION);
				$("#dateObligation").val(data.DATE); 						
				dateValidationR =  data.DATE;  
				var table = $('#dataTableObligation').DataTable(); 
 				var rows = table.rows().remove().draw();
				for (var i=0; i<data.RUBRO.length; i++){

				table.row.add( [
				data.RUBRO[i].rubro,
				data.RUBRO[i].register,
				data.RUBRO[i].value,
				"<input type='text'  onkeypress='return validaNumericos(event)'/   size='10'   id=obligation"+data.RUBRO[i].id+" class='form-control' name='inputObligation'>",
				"<label type='number' id=registerObligation"+data.RUBRO[i].id+">"+ JSON.stringify(data.RUBRO[i].valueP)+"</label>",
				"<a data-toggle='tooltip' title='Validar operación'><button type='button' onclick=\'operateBalanceObligation("+JSON.stringify(data.RUBRO[i].id)+','+JSON.stringify(data.RUBRO[i].rubro)+','+JSON.stringify(data.RUBRO[i].value)+','+JSON.stringify(data.RUBRO[i].idRegister)+','+JSON.stringify(data.RUBRO[i].valueP)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"			
				])
			}
			table.draw( false );
			}
	});

}

function operateBalanceObligation(id,rubro,value,idRegister,valueP){
	var createId =  "#obligation"+id;
	var result= "#registerObligation"+id
	var operate=0;
	var valueRegister = parseInt(value);
	operate = parseInt(valueP) - parseInt($(createId).val());
	var valueAccount=parseInt($(createId).val());
	const found = addObligation.findIndex(element => element['id'] == id);
	console.log(parseInt($(createId).val()))
	if(parseInt($(createId).val())==0){
		swal("No se puede generar una operacion de valor 0", " " , "error");
	}else{
		if(found<0){
			if(operate<0){
					swal("El valor de "+ parseInt($(createId).val())+" es mayor a el valor de  "+ value, " No se puede realizar  la obligacion", "error");
				}else{
					$(result).text(operate);
					addObligation.push({
						"idRegister":idRegister,
						"id": id,
						"rubro": rubro,
						"value":parseInt($(createId).val()),
						"balance":operate
					})
					totalOperateArrayObligation.push({
						"id": id,
						"subtotal": operate,
						"obligation":  parseInt($(createId).val())
					})
					totalOperateObligation = totalOperateObligation + operate;	
					totalObligation = totalObligation + parseInt($(createId).val());
					$("#totalObligation").text("SALDO: "+ totalOperateObligation);														
					$("#totalObligationBalance").text("OBLIGACIÓN: "+ totalObligation);														

				}
				console.log(addObligation)
				console.log(totalOperateArrayObligation)
			}else{

				if(operate<0){
					swal("El valor de "+ parseInt($(createId).val())+" es mayor a el valor de  "+ value, " No se puede realizar la obligación", "error");
				}else{
					$(result).text(operate);
					addObligation[found] ={
						"idRegister":idRegister,
						"id": id,
						"rubro": rubro,
						"value":parseInt($(createId).val()),
						"balance":operate
					}
					totalOperateObligation = totalOperateObligation - totalOperateArrayObligation[found]['subtotal'];	
					totalObligation = totalObligation - totalOperateArrayObligation[found]['obligation'];
					totalOperateArrayObligation[found] = {
						"id": id,
						"subtotal": operate,
						"obligation":  parseInt($(createId).val())
					}
					totalOperateObligation = totalOperateObligation + totalOperateArrayObligation[found]['subtotal'];	
					totalObligation = totalObligation + totalOperateArrayObligation[found]['obligation'];
					$("#totalObligation").text("SALDO: "+ totalOperateObligation);														
					$("#totalObligationBalance").text("OBLIGACIÓN: "+ totalObligation);														

				}
				console.log(addObligation)
				console.log(totalOperateArrayObligation)
		}
		$.ajax({
					url: '{% url "getAccountsByRubro"  0 %}'.replace('0', localStorage.getItem('userID')),
					data: {
						'bussines':localStorage.getItem('idBussines'), 
						'rubro': id,
					},
					dataType: 'json',
					success: function (response) {
						console.log(response)
						var table = $('#dataTableGetAccountsObligation').DataTable(); 
						var rows = table.rows().remove().draw();
						arrayIdAccount.push(response.AC[0])
						arrayIdAccount.push(response.AC[1])
						for (var i=0; i<response.AC.length; i++){
							table.row.add( [
							response.AC[i].account__code,
							response.AC[i].account__description,
							response.AC[i].typeAccount,			
							response.AC[i].document,
							"<input type='text'  onkeypress='return validaNumericos(event)'/ value='"+valueAccount+"'  size='10'   id=obligationAccount"+response.AC[i].id+" class='form-control' name='obligationAccountInput'>",
							"<a data-toggle='tooltip' title='Aceptar valores cuenta'><button type='button' onclick=\'createArrayAccount("+JSON.stringify(id)+','+JSON.stringify(valueAccount)+")\' class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"			
							])
						}
						table.draw( false );
					}
				});
			} 
}	


function createArrayAccount(obligationID,valueAcount){
	var table = $('#dataTableGetAccountsObligation').DataTable(); 
	var data = table.rows().data();
	var debit;
	var credit;

	data.each(function (value, index) {	
		
		if(value[2]=='Debito'){
			debit =  parseInt($("#obligationAccount"+arrayIdAccount[0]).val());
		}else{
			credit = parseInt($("#obligationAccount"+arrayIdAccount[1]).val());	
		}	
    });
	console.log(credit)
	console.log(debit)

	if(debit==credit){
		if(debit==valueAcount &&  credit==valueAcount){
			accountsWithValues.push({"accountID": arrayIdAccount[0],"obligationID": obligationID,"typeAccount":"Debito","value":valueAcount})
			accountsWithValues.push({"accountID": arrayIdAccount[1],"obligationID": obligationID,"typeAccount":"Credito","value":valueAcount})

		}else{
			swal({
			title: "Suma no coincide en los valores contables?",
			text: "Al confirmar esta acción, los valores seran guardado",
			icon: "warning",
			buttons: true,
			dangerMode: true,
			}).then((willDelete) => { 
			if (willDelete) {
				accountsWithValues.push({"accountID": arrayIdAccount[0],"obligationID": obligationID,"typeAccount":"Debito","value":debit});
				accountsWithValues.push({"accountID": arrayIdAccount[1],"obligationID": obligationID,"typeAccount":"Credito","value":debit}) 		 		
			}
			});	
		}
	}else{
		swal("Credito y debito no son iguales","Verifique los valores", "error");
	}
	


}


function createObligation(option){
	if(option==1){
		if(totalObligation==0){
		swal("No puede guardar la obligacion sin valores", "Por favor ingrese la obligacion", "error");
	}else{
		swal({
        title: "Desea terminar la obligación ?",
        text: "Al confirmar esta acción, la obligación sera guardado",
        icon: "warning",
        buttons: true,
        dangerMode: true,
        }).then((willDelete) => { 
        if (willDelete) {

			var obligationCode = $('input[name="numberObligation"]').val();
			var observation = $('textarea[name="observationObligation"]').val();
			var date = $('input[name="dateObligation"]').val();
			if (obligationCode,observation,date) {
				// Create Ajax Call
				$.ajax({
					url: '{% url "createObligation"  0 %}'.replace('0', localStorage.getItem('userID')),
					data: {
						'bussines':localStorage.getItem('idBussines'), 
						'obligationCode': obligationCode,
						'origin': originID,
						'date': date,
						'observation': observation,
						'value':totalObligation,
						'balance': totalOperateObligation,
						'obligations': JSON.stringify(addObligation),
						'accounts': JSON.stringify(accountsWithValues),						
						'register':registerSec
					},
					dataType: 'json',
					success: function (data) {

						$("#divObligation").css("display", "none");
						swal("Creado exitoso de la obligacion!", "Continua con tu proceso!", "success");
						$('textarea[name="observationObligation"]').val("");
						addObligation.length=0;
						totalObligation=0;
						totalOperateArrayObligation.length=0;
						totalOperateObligation=0;
						var table = $('#dataTableObligation').DataTable(); 
						var rows = table.rows().remove().draw();
						$("#totalObligation").text("SALDO: "+ totalOperateObligation);														
						$("#totalObligationBalance").text("OBLIGACIÓN: "+ totalObligation);		
					}
				});
			} else {
				alert("Por favor llene todos los campos");
			}
			return false;
        }
        });
	}
		
	}else{
		if(totalObligation==0){
		swal("No puede guardar la obligacion sin valores", "Por favor ingrese la obligacion", "error");
	}else{
		swal({
			title: "Desea terminar la obligación ?",
       		text: "Al confirmar esta acción, la obligación sera guardado",
			icon: "warning",
			buttons: true,
			dangerMode: true,
			}).then((willDelete) => {
			if (willDelete) {

				var obligationCode = $('input[name="numberObligation"]').val();
				var observation = $('textarea[name="observationObligation"]').val();
				var date = $('input[name="dateObligation"]').val();
				if (obligationCode,observation,date) {
					// Create Ajax Call
					$.ajax({
						url: '{% url "createObligation"  0 %}'.replace('0', localStorage.getItem('userID')),
						data: {
							'bussines':localStorage.getItem('idBussines'), 
							'obligationCode': obligationCode,
							'origin': originID,
							'date': date,
							'observation': observation,
							'value':totalObligation,
							'balance': totalOperateObligation,
							'obligations': JSON.stringify(addObligation),
							'accounts': JSON.stringify(accountsWithValues),						
							'register':registerSec
						},
						dataType: 'json',
						success: function (data) {

							$("#divObligation").css("display", "none");
							swal("Creado exitoso de la obligación!", "Continua con tu proceso!", "success");
							$('textarea[name="observationObligation"]').val("");
							addObligation.length=0;
							totalObligation=0;
							totalOperateArrayObligation.length=0;
							totalOperateObligation=0;
							var table = $('#dataTableObligation').DataTable(); 
							var rows = table.rows().remove().draw();
							$("#totalObligation").text("SALDO: "+ totalOperateObligation);														
							$("#totalObligationBalance").text("OBLIGACIÓN: "+ totalObligation);		
							getDataToGenerateVoucher();

						}
					});
				} else {
					alert("Por favor llene todos los campos");
				}
				return false;
			}
			});
		}		
	}
	
}
function getDataToGenerateVoucher(){

	$("#divCreate").css("display", "none");
	$("#divRegister").css("display", "none");
	$("#divObligation").css("display", "none");
	$("#divVoucherPayment").css("display", "block");

	$.ajax({
			url: '{% url "getDataToVoucherPayment"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {

				const $selectTH = document.querySelector("#terceroSelectVoucher");
				const $select = document.querySelector("#selectObligationVoucher");
				for (let i = $select.options.length; i >= 0; i--) {
						$select.remove(i);
				}
				for (let i = $selectTH.options.length; i >= 0; i--) {
						$selectTH.remove(i);
				}  
				$('#terceroSelectVoucher').append(`<option  hidden  selected"> Selecciona una opción</option>`);
				$('#selectObligationVoucher').append(`<option  hidden  selected"> Selecciona una opción</option>`);	
				for (var i=0; i<data.MV.length; i++){
					$('#selectObligationVoucher').append('<option value='+data.MV[i].id+'>'+data.MV[i].register+'</option>')
				}
				for (var i=0; i<data.TH.length; i++){
					$('#terceroSelectVoucher').append('<option value='+data.TH[i].id+'>'+data.TH[i].name + " " +data.TH[i].surnames+'</option>')
				}

				var table = $('#dataTableGetObligation').DataTable(); 
				var rows = table.rows().remove().draw();
				for (var i=0; i<data.VP.length; i++){

					table.row.add( [
					data.VP[i].vouchePayment,
					data.VP[i].observation,
					data.VP[i].value,
					data.VP[i].balance,
					"<a data-toggle='tooltip' type='button' title='Actualizar comprobante de pago'><button  class='btn btn-primary btn-sm'><i class='fa fa-check' aria-hidden='true'></i></button></a>"+
					"<a data-toggle='tooltip' type='button' title='Eliminar comprobante de pago'><button onclick=\'deleteObligation("+JSON.stringify(data.VP[i].id)+','+JSON.stringify(data.VP[i].vouchePayment)+")\' class='btn btn-primary btn-sm'><i class='fa fa-trash'></i></button></a>"
					])
				}
				table.draw( false );
			}
	});
	$.ajax({
			url: '{% url "getSerialVoucherPayment"  0 %}'.replace('0', localStorage.getItem('userID')),
			data: {
				'bussines':localStorage.getItem('idBussines'),
				'origin': originID
			},
			dataType: 'json',
			success: function (data) {
				$("#observationVoucherPayment").val(data.OB); 

			}
	});
}

</script>

{% endblock %}
</body>
